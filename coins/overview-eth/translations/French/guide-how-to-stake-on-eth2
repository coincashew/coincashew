---
description: >-
  Devenez un validateur et aidez √† s√©curiser eth2, une blockchain. Toute personne ayant 32 ETH peut se joindre.
---

# Guide : Comment mettre en jeu sur le r√©seau principal ETH2 avec Prysm sur Ubuntu

{% hint style="danger" %}
**Mise √† jour 24 Nov 2020**: Le [nouveau guide principal est situ√© ici](guide-or-how-to-setup-a-validator-on-eth2-mainnet/).

Les instructions ci-dessous sont maintenant obsol√®tes et pour r√©f√©rence seulement.
{% endhint %}











{% hint style="info" %}
[Prysm](https://github.com/prysmaticlabs/prysm) est une impl√©mentation Go du protocole Ethereum 2.0 centr√©e sur l'utilisabilit√©, la s√©curit√© et la fiabilit√©. Prysmatic Labs est d√©velopp√© par [Prysmatic Labs](https://prysmaticlabs.com/), une entreprise qui se concentre uniquement sur le d√©veloppement de son client. Prysm est √©crit en Go et distribu√© sous licence GPL-3.0.
{% endhint %}

## üèÅ 0. Pr√©-requis

### üë©üíª Comp√©tences pour g√©rer un validateur eth2 et un n≈ìud de balises

En tant que validateur pour eth2, vous aurez g√©n√©ralement les capacit√©s suivantes :

* Connaissances op√©rationnelles sur la mani√®re de configurer, d'ex√©cuter et de maintenir en permanence un noeud de balises et un validateur eth2
* un engagement √† maintenir votre validateur 24/7/365
* comp√©tences de base du syst√®me d'exploitation
* ont appris l'essentiel en regardant ['Introduction √† Eth2 & Prise pour les d√©butants' par Superphiz](https://www.youtube.com/watch?v=tpkpW031RCI)
* sont pass√©s ou sont activement inscrits au cours [Eth2 Study Master cours](https://ethereumstudymaster.com/)
* et ont lu les [8 Choses que chaque validateur Eth2 devrait savoir.](https://medium.com/chainsafe-systems/8-things-every-eth2-validator-should-know-before-staking-94df41701487)

### üéó **Pr√©requis de configuration minimum**

* **Syst√®me d'exploitation :** Linux 64 bits \(i.e. Ubuntu 20.04 LTS\)
* **Processeur :** Dual core CPU, Intel Core i5‚Äì760 ou AMD FX-8100 ou sup√©rieur
* **Memory:** 8GB RAM
* **Stockage :** 20 Go SSD
* **Internet :** Connexion Internet haut d√©bit avec des vitesses d'au moins 1 Mbps.
* **Puissance :** √ânergie √©lectrique fiable.
* **Solde ETH :** au moins 32 ETH et quelques ETH pour les frais de transaction de d√©p√¥t
* **Portefeuille**: Metamask install√©

### üèã‚ôÇ Configuration mat√©rielle recommand√©e

* **Syst√®me d'exploitation :** Linux 64 bits \(i.e. Ubuntu 20.04 LTS\)
* **Processeur :** Quad core CPU, Intel Core i7‚Äì4770 ou AMD FX-8310 ou sup√©rieur
* **M√©moire :** 16 Go de RAM ou plus
* **Stockage :** SSD 1To ou plus
* **Internet :** Connexions Internet √† large bande avec des vitesses d'au moins 10 Mbps
* **Power:** Reliable electrical power with uninterruptible power supply \(UPS\)
* **Solde ETH :** au moins 32 ETH et quelques ETH pour les frais de transaction de d√©p√¥t
* **Portefeuille**: Metamask install√©

{% hint style="warning" %}
‚ú® **Astuce Pro Validator**: Il est fortement recommand√© de commencer par une toute nouvelle instance d'un OS, d'une VM et/ou d'une machine. √âvitez les maux de t√™te en NE r√©utilisant PAS les cl√©s testnet, les portefeuilles ou les bases de donn√©es de votre validateur principal.
{% endhint %}

### üîì Meilleures pratiques de validateur eth2 recommand√©es

Si vous avez besoin d'id√©es ou d'un rappel pour s√©curiser votre validateur, reportez-vous √†

{% page-ref page="guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md" %}

### üõ† Setup Ubuntu

Si vous avez besoin d'installer Ubuntu, reportez-vous √†

{% page-ref page="../overview-xtz/guide-how-to-setup-a-baker/install-ubuntu.md" %}

### üé≠ Configurer Metamask

Si vous avez besoin d'installer Metamask, reportez-vous √†

{% page-ref page="../../wallets/browser-wallets/metamask-ethereum.md" %}

## üå± 1. Acheter/√©changer ou consolider ETH

{% hint style="info" %}
Chaque 32 ETH que vous poss√©dez vous permet de faire 1 validateur. Vous pouvez ex√©cuter des milliers de validateurs avec votre n≈ìud de balises.
{% endhint %}

Votre ETH \\(ou des multiples de 32 ETH\\) doit √™tre consolid√© en une seule adresse accessible avec Metamask.

Si vous devez acheter/√©changer ou recharger votre ETH √† un multiple de 32, d√©part :

{% page-ref page="guide-how-to-buy-eth.md" %}

## üë©üíª 2. S'inscrire pour √™tre un validateur sur le tableau de bord

1. Installez des d√©pendances, l'outil de d√©p√¥t de la fondation ethereum et g√©n√©rez vos deux paires de cl√©s.

{% hint style="info" %}
Chaque validateur aura deux jeux de paires de cl√©s. Une **cl√© de signature** et une cl√© de retrait **.** Ces cl√©s sont d√©riv√©es d'une seule phrase mn√©monique. [En savoir plus sur les cl√©s.](https://blog.ethereum.org/2020/05/21/keys/)
{% endhint %}

Vous avez le choix de t√©l√©charger l'outil de d√©p√¥t de la fondation [ethereum pr√©-compil√©](https://github.com/ethereum/eth2.0-deposit-cli) ou de le construire √† partir de la source.

{% tabs %}
{% tab title="Pre-built eth2deposit-cli" %}
T√©l√©charger eth2deposit-cli.

```bash
cd $HOME
wget https://github.com/ethereum/eth2.0-deposit-cli/releases/download/v1.0.0/eth2deposit-cli-9310de0-linux-amd64.tar.gz
```

V√©rifiez que la somme de contr√¥le SHA256 correspond √† la somme de contr√¥le sur la page de [releases](https://github.com/ethereum/eth2.0-deposit-cli/releases/tag/v1.0.0).

```bash
sha256sum eth2deposit-cli-9310de0-linux-amd64.tar.gz 
# SHA256 doit √™tre
# b09da136895a7f77a4b430924ea2ae5827fa47b2bf444c4ea6fcfac5b04b8c8a
```

Extraire l'archive.

```text
tar -xvf eth2deposit-cli-9310de0-linux-amd64.tar.gz
cd eth2deposit-cli-9310de0-linux-amd64
```

Cr√©er un nouveau mn√©monique.

```text
./deposit new-mn√©monic --chain mainnet
```
{% endtab %}

{% tab title="Build from source code" %}
Installer les d√©pendances.

```text
sudo apt update
sudo apt install python3-pip git -y
```

T√©l√©charger le code source et installer.

```text
mkdir ~/git
cd ~/git
git clone https://github.com/ethereum/eth2.0-deposit-cli.git
cd eth2.0-deposit-cli
sudo ./deposit.sh install
```

Cr√©er un nouveau mn√©monique.

```text
./deposit.sh new-mn√©monic --chain mainnet
```
{% endtab %}

{% tab title="Advanced - Most Secure" %}
{% hint style="warning" %}
üî•**\[ Optionnel \] Astuce de s√©curit√© Pro**: Ex√©cutez l'outil eth2deposit-cli et g√©n√©rez votre **seed mn√©monique** pour vos cl√©s de validateur sur une **machine hors ligne √† gapp√© √† air**.

Vous pouvez copier par cl√© USB les binaires eth2deposit-cli pr√©-construits depuis une machine en ligne vers une machine hors ligne √† air gappe.

* Prot√®ge contre les attaques de journalisation des cl√©s, les attaques bas√©es sur des logiciels malveillants/virus et les autres attaques de pare-feu ou les attaques de s√©curit√©.
* √âloign√© physiquement du reste de votre r√©seau.
* Ne doit pas avoir de connexion r√©seau, c√¢bl√©e ou sans fil.
* N'est pas une VM sur une machine avec une connexion r√©seau.
* En savoir plus sur [la gappage d'air sur wikipedia](https://en.wikipedia.org/wiki/Air_gap_%28networking%29).
{% endhint %}
{% endtab %}
{% endtabs %}

1. Suivez les instructions et choisissez un mot de passe. Notez votre mn√©monique et gardez ceci s√ªr et **hors ligne**.
2. Suivez les √©tapes sur [https://launchpad.ethereum.org/](https://launchpad.ethereum.org/) en sautant les √©tapes que vous venez de terminer. √âtudier le mat√©riel d'aper√ßu eth2 phase 0. Comprendre eth2 est la cl√© du succ√®s !
3. De retour sur le site du tableau de bord, t√©l√©chargez votre`deposit_data-#########.json` trouv√© dans le r√©pertoire `validator_keys`.
4. Connectez-vous au tableau de bord avec votre portefeuille Metamask, r√©visez et acceptez les conditions.
5. Confirmez la transaction\(s\\). Il y a une transaction de d√©p√¥t de 32 ETH pour chaque validateur.

{% hint style="info" %}
Votre transaction est en train d'envoyer et de d√©poser votre ETH √† l'adresse officielle [du contrat de d√©p√¥t ETH2. ](https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/)

**V√©rifier**, _double-v√©rifier_, _**triple v√©rification**_ que l'adresse officielle du contrat de d√©p√¥t Eth2 est correcte.[`0x00000000219ab540356cBB839Cbe05303d7705Fa`](https://etherscan.io/address/0x00000000219ab540356cbb839cbe05303d7705fa)
{% endhint %}

{% hint style="danger" %}
N'oubliez pas d'√©crire ou d'enregistrer votre seed mn√©monique **hors ligne**. _Pas d'e-mail. Pas de cloud._

Faites des **sauvegardes hors ligne**, telles qu'une cl√© USB, de vos **`validator_keys`** \`\`r√©pertoire.
{% endhint %}

## üõ∏ 3. Install a ETH1 node

{% hint style="info" %}
Ethereum 2.0 n√©cessite une connexion √† Ethereum 1.0 afin de surveiller 32 d√©p√¥ts de validateur ETH. H√©berger votre propre noeud Ethereum 1.0 est le meilleur moyen de maximiser la d√©centralisation et de minimiser la d√©pendance √† l'√©gard de tiers tels qu'Infura.
{% endhint %}

{% hint style="warning" %}
Les √©tapes suivantes supposent que vous avez termin√© le [guide des meilleures pratiques de s√©curit√©](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md).
{% endhint %}

Votre choix entre [**OpenEthereum**](https://www.parity.io/ethereum/)**,** [**Geth**](https://geth.ethereum.org/)**,** [**Besu**](https://besu.hyperledger.org/) **ou** [**Nethermind**](https://www.nethermind.io/)**.**

{% tabs %}
{% tab title="OpenEthereum \(Parity\)" %}
#### ü§ñ Installez et ex√©cutez OpenEthereum.

```text
mkdir ~/openethereum && cd ~/openethereum
wget https://github.com/openethereum/openethereum/releases/download/v3.0.1/openethereum-linux-v3.0.1.zip
unzip openethereum*.zip
chmod +x openethereum
rm openethereum*.zip
```

‚öô **Configuration et configuration du syst√®me**

Ex√©cutez ce qui suit pour cr√©er un **fichier unitaire** pour d√©finir votre configuration `eth1.service`.

```bash
chat > $HOME/eth1. ervice << EOF 
[Unit]
Description = service eth1 openethereum
Wants = r√©seau-en ligne. arget
Apr√®s = r√©seau-en ligne. arget 

[Service]
Utilisateur = $(whoami)
WorkkingDirectory= /home/$(whoami)/openethereum
ExecStart = /home/$(whoami)/openethereum/openethereum --chain foundation
Red√©marrer = on-failure

[Install]
WantedBy = multi-user. arget
EOF
```

D√©placez le fichier d'unit√© vers `/etc/systemd/system` et donnez-lui les permissions.

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
```

```bash
sudo chmod 644 /etc/systemd/system/eth1.service
```

Ex√©cutez ce qui suit pour activer le d√©marrage automatique au d√©marrage.

```text
sudo systemctl daemon-reload
sudo systemctl active eth1
```

#### ‚õì D√©marrer OpenEthereum sur le r√©seau principal.

```text
sudo systemctl start eth1
```
{% endtab %}

{% tab title="Geth" %}
#### üß¨ Installer depuis le r√©f√©rentiel.

```text
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt-get update -y
sudo apt-get install ethereum -y
```

‚öô **Configuration et configuration du syst√®me**

Ex√©cutez ce qui suit pour cr√©er un **fichier unitaire** pour d√©finir votre configuration `eth1.service`.

```bash
chat > $HOME/eth1. ervice << EOF 
[Unit]
Description = obtenir le service eth1
Wants = r√©seau-en ligne. arget
Apr√®s = r√©seau-en ligne. arget 

[Service]
Utilisateur = $(whoami)
ExecStart = /usr/bin/geth --rpc --http
Red√©marrer = on-failure

[Install]
WantedBy = multi-utilisateurs. arget
EOF
```

D√©placez le fichier d'unit√© vers `/etc/systemd/system` et donnez-lui les permissions.

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
sudo chmod 644 /etc/systemd/system/eth1.service
```

Ex√©cutez ce qui suit pour activer le d√©marrage automatique au d√©marrage.

```text
sudo systemctl daemon-reload
sudo systemctl active eth1
```

#### ‚õì Commencez √† obtenir sur le r√©seau principal.

```text
sudo systemctl start eth1
```
{% endtab %}

{% tab title="Besu" %}
#### üß¨ Installez la d√©pendance java.

```text
sudo apt install openjdk-11-jdk
```

#### üåú T√©l√©charger et d√©compresser Besu.

```text
cd
wget -O besu.tar.gz https://bintray.com/hyperledger-org/besu-repo/download_file?file_path=besu-1.5.0.tar.gz
tar -xvf besu.tar.gz
rm besu.tar.gz
mv besu-1.5.0 besu
```

‚öô **Configuration et configuration du syst√®me**

Ex√©cutez ce qui suit pour cr√©er un **fichier unitaire** pour d√©finir votre configuration `eth1.service`.

```bash
chat > $HOME/eth1. ervice << EOF 
[Unit]
Description = service eth1 openethereum
Wants = r√©seau-en ligne. arget
Apr√®s = r√©seau-en ligne. arget 

[Service]
Utilisateur = $(whoami)
R√©pertoire de travail= /home/$(whoami)/besu/bin
ExecStart = /home/$(whoami)/besu/bin/besu --data-path="$HOME/. thereum_besu"
Red√©marrage = √©chec

[Install]
WantedBy = multi-utilisateur. arget
EOF
```

D√©placez le fichier d'unit√© vers `/etc/systemd/system` et donnez-lui les permissions.

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
sudo chmod 644 /etc/systemd/system/eth1.service
```

Ex√©cutez ce qui suit pour activer le d√©marrage automatique au d√©marrage.

```text
sudo systemctl daemon-reload
sudo systemctl active eth1
```

#### ‚õì D√©marrer besu sur le r√©seau principal.

```text
sudo systemctl start eth1
```
{% endtab %}

{% tab title="Nethermind" %}
#### ‚öô Installez les d√©pendances.

```text
sudo apt-get update && sudo apt-get install libsnappy-dev libc6-dev libc6 unzip -y
```

#### üåú T√©l√©chargez et d√©zippez Nethermind.

```text
mkdir ~/nethermind && cd ~/nethermind
wget -O nethermind.zip https://nethdev.blob.core.windows.net/builds/nethermind-linux-amd64-1.8.77-9d3a58a.zip
unzip nethermind.zip
rm nethermind.zip
```

#### üõ∏ Lancez Nethermind.

```text
./Nethermind.Launcher
```

* S√©lectionnez `Noeud Ethereum`
* S√©lectionnez `Ethereum (r√©seau principal)` puis s√©lectionnez `Synchronisation rapide`
* Oui pour activer RPC web3 / JSON
* Accepter l'IP par d√©faut
* Ignorer l'enregistrement ethstats
{% endtab %}

{% tab title="Minimum Hardware Setup" %}
{% hint style="info" %}
Infura est adapt√© pour des installations d'espace disque limit√©. Toujours ex√©cuter votre propre n≈ìud eth1 lorsque c'est possible.
{% endhint %}

Inscrivez-vous pour obtenir une cl√© d'acc√®s API sur [https://infura.io/](https://infura.io/)

1. Inscrivez-vous pour un compte gratuit.
2. Confirmez votre adresse e-mail.
3. Visitez votre tableau de bord [https://infura.io/dashboard](https://infura.io/dashboard)
4. Cr√©ez un projet, donnez-lui un nom.
5. S√©lectionnez **le r√©seau principal** comme ENDPOINT
6. Copiez votre cl√© API.
7. Mettre √† jour le param√®tre **http-web3provider** dans la section **start beacon chain**.

```bash
#exemple de param√®tre
--http-web3provider=https://infura.io/v3/<YOUR_API_KEY>
```
{% endtab %}
{% endtabs %}



{% hint style="info" %}
La synchronisation du noeud eth1 peut prendre jusqu'√† 24 heures.
{% endhint %}

{% hint style="success" %}
Votre n≈ìud eth1 est enti√®rement synchronis√© lorsque ces √©v√©nements se produisent.

* **`OpenEthereum:`** `Imported #<block number>`
* **`Geth:`** `Nouveau segment de cha√Æne import√©`
* **`Besu :`** `Import√© #<block number>`
* **`Pens√©e n√©ant:`** `Ne plus synchroniser les anciennes en-t√™tes`
{% endhint %}

#### üõ† Commandes eth1.service utiles

**Pour voir et suivre les logs eth1**

```text
journalctl -u eth1 -f
```

üóí **Pour arr√™ter le service eth1**

```text
sudo systemctl stop eth1
```

{% hint style="danger" %}
üõë **Avant de continuer le reste de ce guide, Nous vous recommandons d'attendre jusqu'au 1er D√©cembre car le code Prysm se pr√©pare rapidement pour le r√©seau principal.** :construction :
{% endhint %}

## üí° 4. Install Prysm

```bash
mkdir ~/prysm && cd ~/prysm 
curl https://raw.githubusercontent.com/prysmaticlabs/prysm/master/prysm.sh --output prysm.sh && chmod +x prysm.sh 
```

{% hint style="info" %}
Prysm est un client Ethereum 2.0 qui est livr√© en deux composants.

**Cha√Æne de balises client** - Responsable de la gestion de l'√©tat de la cha√Æne de balises, m√©lange de validateurs, et plus encore.

**Validator client** - Responsable de la production de nouveaux blocs et attestations dans la cha√Æne de balises et les cha√Ænes de fragments.
{% endhint %}

## üî• 5. Configurer la redirection de port et/ou le pare-feu

Sp√©cifique √† vos param√®tres de configuration de r√©seau ou de fournisseur de services cloud, [assurez-vous que les ports pare-feu de votre validateur sont ouverts et accessibles.](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md#configure-your-firewall)

* **Prysm balise de maille de n≈ìud** utilisera le port 12000 pour udp et le port 13000 pour tcp
* **eth1** noeud n√©cessite le port 30303 pour tcp et udp

{% hint style="info" %}
‚ú® **Astuce de redirection de port:** Vous devrez transf√©rer et ouvrir les ports √† votre validateur. V√©rifiez qu'il fonctionne avec [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) ou [https://canyouseeme.org/](https://canyouseeme.org/).
{% endhint %}

## üé© 6. Importer une cl√© de validateur

Choisir la commande correcte selon la fa√ßon dont vous avez install√© **eth2deposit-cli.**

{% tabs %}
{% tab title="Pre-built eth2deposit-cli" %}
```bash
$HOME/prysm/prysm.sh import des comptes de validateur --keys-dir=$HOME/eth2deposit-cli-9310de0-linux-amd64/validator_keys
```
{% endtab %}

{% tab title="Built from source code" %}
```bash
$HOME/prysm/prysm.sh import des comptes de validateur --keys-dir=$HOME/git/eth2.0-deposit-cli/validator_keys
```
{% endtab %}
{% endtabs %}

Acceptez l'emplacement du portefeuille par d√©faut, entrez un nouveau mot de passe pour chiffrer votre portefeuille et entrez le mot de passe pour vos comptes import√©s.

{% hint style="danger" %}
**AVERTISSEMENT**: N'UTILISEZ PAS LES CL√âS ORIGINELLES POUR VALIDER AVEC UN AUTRE CLIENT, OU VOUS DEVEZ OBTENIR SLASHED.
{% endhint %}

## üèÇ 7. D√©marrer la cha√Æne de balises

{% hint style="warning" %}
Si vous avez particip√© √† l'un des filets de test pr√©c√©dents, vous devez effacer la base de donn√©es.

```bash
$HOME/prysm/prysm.sh balise cha√Æne --clear-db
```
{% endhint %}

Vous avez le choix d'ex√©cuter manuellement une cha√Æne de balises et un validateur √† partir de la ligne de commande ou automatiquement avec le syst√®me.

{% tabs %}
{% tab title="Systemd - Automated" %}
#### üç∞ Avantages de l'utilisation du syst√®me pour votre cha√Æne de balises et validateur <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. D√©marrage automatique de la cha√Æne de balises lorsque l'ordinateur red√©marre en raison de la maintenance, de la panne d'alimentation, etc.
2. Red√©marrer automatiquement les processus de cha√Æne de balises plant√©es.
3. Maximisez le temps de disponibilit√© et les performances de votre cha√Æne de balises.

#### üõ† Instructions de configuration

Ex√©cutez ce qui suit pour cr√©er un fichier **unit√©** pour d√©finir votre configuration`beacon-chain.service`.

```bash
chat > $HOME/beacon-chain. ervice << EOF 
# Le service de cha√Æne de balises eth2 (partie du syst√®me)
# fichier: /etc/systemd/system/beacon-chain. ervice 

[Unit]
Description = service de cha√Æne de balises eth2
Vait = r√©seau-en ligne. arget
Apr√®s = r√©seau-en ligne. arget 

[Service]
Utilisateur = $(whoami)
Environnement = "ClientIP=$(curl -s v4. dent.me)"
WorkkingDirectory= /home/$(whoami)/prysm
ExecStart = /home/$(whoami)/prysm/prysm.sh beacon-chain --p2p-host-ip=${ClientIP} --monitoring-host="0.0.0. " --http-web3provider=http://127.0.0. :8545 --accept-terms-of-use 
Restart = on-failure

[Install]
WantedBy = multi-user. arget
EOF
```

{% hint style="info" %}
Les utilisateurs de Geth peuvent atteindre des performances plus √©lev√©es avec

```bash
--http-web3provider=$HOME/.ethereum/geth.ipc
```
{% endhint %}

D√©placez le fichier d'unit√© vers `/etc/systemd/system` et donnez-lui les permissions.

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```

Ex√©cutez ce qui suit pour activer le d√©marrage automatique au d√©marrage, puis d√©marrez votre service de n≈ìuds balises.

```text
sudo systemctl daemon-reload
sudo systemctl enable beacon-chain
sudo systemctl start beacon-chain
```

{% hint style="success" %}
Beau travail. Votre cha√Æne de balises est maintenant g√©r√©e par la fiabilit√© et la robustesse du syst√®me. Voici quelques commandes pour utiliser le syst√®me.
{% endhint %}

### üõ† Quelques commandes syst√®me utiles

#### ‚úÖ V√©rifiez si la cha√Æne de balises est active

```text
sudo systemctl est une balise active
```

#### üîé Afficher l'√©tat de la cha√Æne de balises

```text
sudo systemctl status beacon-chain
```

#### üîÑ Red√©marrage de la cha√Æne de balises

```text
sudo systemctl recharger ou red√©marrer la balise en cha√Æne
```

#### üõë Arr√™t de la cha√Æne de balises

```text
sudo systemctl arr√™te la balise
```

#### üóí Visualisation et filtrage des logs

```bash
journalctl --unit=beacon-chain --since=hier
journalctl --unit=beacon-chain --since=today
journalctl --unit=beacon-chain --since='2020-12-01 00:00:00' --until='2020-12-02 12:00:00'
```
{% endtab %}

{% tab title="CLI - Manual" %}
Dans un nouveau terminal, d√©marrez la cha√Æne de balises.

```bash
$HOME/prysm/prysm.sh beacon-chain \
--p2p-host-ip=$(curl -s v4.ident.me) \
--http-web3provider="http://127.0.0.1:8545"
--monitoring-host="0.0.0" \
--accept-terms-of-use
```

{% hint style="info" %}
Les utilisateurs de Geth peuvent atteindre des performances plus √©lev√©es avec

```bash
--http-web3provider=$HOME/.ethereum/geth.ipc
```
{% endhint %}
{% endtab %}
{% endtabs %}

## üß¨ 8. D√©marrer le validateur <a id="9-start-the-validator"></a>

Stockez le mot de passe de votre validateur dans un fichier et faites-le en lecture seule.

```bash
echo "my_password_goes_here" > $HOME/.eth2validators/validators-password.txt
sudo chmod 600 $HOME/.eth2validators/validators-password.txt
```

Vous avez le choix d'ex√©cuter un validateur manuellement √† partir de la ligne de commande ou automatiquement avec le syst√®me.

{% tabs %}
{% tab title="Systemd - Automated" %}
#### üç∞ Les avantages de l'utilisation du syst√®me pour votre validateur <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. D√©marrage automatique de votre validateur lorsque l'ordinateur red√©marre en raison de la maintenance, de la panne d'alimentation, etc.
2. Red√©marrer automatiquement les processus de validateur plant√©s.
3. Maximisez le temps de disponibilit√© et les performances de votre validateur.

#### üõ† Instructions de configuration

Ex√©cutez ce qui suit pour cr√©er un fichier **unit√©** pour d√©finir votre configuration`validator.service`.

```bash
chat > $HOME/validateur. ervice << EOF 
# Le service de validation eth2 (partie du syst√®me)
# fichier: /etc/systemd/system/validator. ervice 

[Unit]
Description = service de validateur eth2
Vait = r√©seau-en ligne. arget beacon-chain.service
Apr√®s = r√©seau-en ligne. arget 

[Service]
Utilisateur = $(whoami)
WorkkingDirectory= /home/$(whoami)/prysm
ExecStart = /home/$(whoami)/prysm/prysm. h validateur --accept-terms-of-use --wallet-password-file /home/$(whoami)/.eth2validators/validators-password. xt
Red√©marrer = en √©chec

[Install]
WantedBy = multi-utilisateur. arget
EOF
```

D√©placez le fichier d'unit√© vers `/etc/systemd/system` et donnez-lui les permissions.

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
sudo chmod 644 /etc/systemd/system/validator.service
```

Ex√©cutez ce qui suit pour activer le d√©marrage automatique au d√©marrage, puis d√©marrez votre validateur.

```text
sudo systemctl daemon-reload
sudo systemctl active le validateur
sudo systemctl d√©marrer le validateur
```

### üõ† Quelques commandes syst√®me utiles

#### ‚úÖ V√©rifie si le validateur est actif

```text
sudo systemctl est un validateur actif
```

#### üîé Afficher l'√©tat du validateur

```text
sudo systemctl status validator
```

#### üîÑ Red√©marrage du validateur

```text
sudo systemctl recharger ou red√©marrer le validateur
```

#### üõë Arr√™t du validateur

```text
sudo systemctl stop validator
```

#### üóÑ Visualisation et filtrage des logs

```bash
journalctl --unit=validator --since=hier
journalctl --unit=validator --since =today
journalctl --unit=validator --since='2020-12-01 00:00:00' --until='2020-12-02 12:00:00'
```
{% endtab %}

{% tab title="CLI - Manual" %}
Dans un nouveau terminal, d√©marrez le validateur.

```bash
$HOME/prysm/prysm.sh validator \
--accept-terms-of-use \
--wallet-password-file /home/$(whoami)/.eth2validators/validators-password.txt
```
{% endtab %}
{% endtabs %}

V√©rifiez que votre **cl√© publique de validateur** appara√Æt dans les logs. Exemple ci-dessous:

```text
INFO Activ√© le validateur voting_pubkey: 0x2374.....7121
```

{% hint style="info" %}
**Validator client** - Responsable de la production de nouveaux blocs et attestations dans la cha√Æne de balises et les cha√Ænes de fragments.

**Cha√Æne de balises client** - Responsable de la gestion de l'√©tat de la cha√Æne de balises, m√©lange de validateurs, et plus encore.
{% endhint %}

{% hint style="success" %}
F√©licitations. Une fois que votre balise est synchronis√©e, validateur et en cours d'ex√©cution, il vous suffit d'attendre l'activation. Ce processus prend jusqu'√† 24 heures. Lorsque vous √™tes assign√©, votre validateur commencera √† cr√©er et √† voter sur des blocs tout en gagnant des r√©compenses de mise en jeu ETH.

Utilisez [beaconcha.in](https://beaconcha.in/) et [cr√©ez un compte](https://beaconcha.in/register) pour cr√©er des alertes et suivre les performances de votre validateur.
{% endhint %}

## üïí 9. Synchronisation de l'heure

{% hint style="info" %}
Parce que la cha√Æne de balises repose sur des temps pr√©cis pour effectuer des attestations et produire des blocs, l'heure de votre ordinateur doit √™tre pr√©cise √† l'heure r√©elle NTP ou NTS dans 0. secondes.
{% endhint %}

Installer **Chrony** avec le guide suivant.

{% hint style="info" %}
chrony est une impl√©mentation du Network Time Protocol et aide √† garder l'heure de votre ordinateur synchronis√©e avec NTP.
{% endhint %}

## üîé 10. Surveiller votre validateur avec Grafana et Prometheus

Prometheus est une plate-forme de surveillance qui recueille des m√©triques √† partir de cibles surveill√©es en fermant des terminaux HTTP m√©triques sur ces cibles. [La documentation officielle est disponible ici.](https://prometheus.io/docs/introduction/overview/) Grafana est un tableau de bord utilis√© pour visualiser les donn√©es collect√©es.

### üê£ Installation 10.1

Installez un exportateur de noeuds prometheus et prometheus.

```text
sudo apt-get install -y prometheus prometheus-node-exportateur
```

Installer grafana.

```bash
wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
echo "deb https://packages.grafana.com/oss/deb stable main" > grafana. est
sudo mv grafana.list /etc/apt/sources.list.d/grafana.list
sudo apt-get update && sudo apt-get install -y grafana
```

Activer les services pour qu'ils d√©marrent automatiquement.

```bash
sudo systemctl active grafana-server.service
sudo systemctl active prometheus.service
sudo systemctl active prometheus-node-exporter.service
```

Mettre √† jour **prometheus.yml** situ√© dans `/etc/prometheus/prometheus.yml`

```bash
cat > $HOME/prometheus.yml << EOF
global :
  scrape_interval: 15s # Par d√©faut, griller les cibles toutes les 15 secondes.

  # Attachez ces √©tiquettes √† toutes les s√©ries temporelles ou alertes lorsque vous communiquez avec
  # syst√®mes externes (f√©d√©ration, stockage √† distance, Gestionnaire d'alertes).
  external_labels:
    moniteur: 'codelab-monitor'

# Une configuration de scrape contenant exactement un point d'extr√©mit√© √† scrape:
# Ici, c'est Prometheus lui-m√™me.
scrape_configs:
  - job_name: 'node_exporter'
    static_configs:
      - targets: ['localhost:9100']
  - job_name: 'validator'
    static_configs:
      - targets: ['localhost:8081']
  - job_name: 'beacon node'
    static_configs:
      - targets: ['localhost:8080']
  - job_name: 'slasher'
    static_configs:
      - targets: ['localhost:8082']
EOF
sudo mv $HOME/prometheus. ml /etc/prometheus/prometheus.yml
```

Enfin, red√©marrez les services.

```bash
sudo systemctl red√©marre grafana-server.service
sudo systemctl red√©marrer prometheus.service
sudo systemctl red√©marrer prometheus-node-exporter.service
```

V√©rifiez que les services fonctionnent correctement :

```text
sudo systemctl statut grafana-server.service prometheus.service prometheus-node-exporter.service
```

{% hint style="info" %}
üí° **Rappel**: Assurez-vous que le port 3000 est ouvert sur le pare-feu et/ou le port transf√©r√© si vous avez l'intention de voir les informations de surveillance depuis une autre machine.
{% endhint %}

### üì∂ 10.2 Configuration des tableaux de bord Grafana

1. Ouvrez [http://localhost:3000](http://localhost:3000) ou [http://&lt;your](http://<your) validator's ip address&gt;:3000 dans votre navigateur local.
2. Connectez-vous avec **admin** / **admin**
3. Changer le mot de passe
4. Cliquez sur l'ic√¥ne **√©quipement de configuration** , puis **Ajouter une source de donn√©es**
5. S√©lectionnez **Prometheus**
6. D√©finir **Name** √† **"Prometheus**"
7. D√©finir l'URL **** √† [http://localhost:9090](http://localhost:9090)
8. Cliquez sur **Enregistrer & Tester**
9. **T√©l√©chargez et enregistrez** ce [**fichier json**](https://raw.githubusercontent.com/GuillaumeMiralles/prysm-grafana-dashboard/master/less_10_validators.json)**.** Ou si vous avez plus de 10 validateurs, utilisez ce [fichier json](https://raw.githubusercontent.com/GuillaumeMiralles/prysm-grafana-dashboard/master/more_10_validators.json).
10. Cliquez sur **Cr√©er +** ic√¥ne &gt; **Importer**
11. Ajouter un tableau de bord par **T√©l√©charger le fichier JSON**
12. Cliquez sur le bouton **Importer**.

![Tableau de bord Prysm](../../.gitbook/assets/prysm_dash.png)

### ‚ö† Notifications d'alerte de configuration 10.3

{% hint style="info" %}
Configurez les alertes pour √™tre averti si vos validateurs se d√©connectent.
{% endhint %}

√ätre inform√© des probl√®mes avec vos validateurs. Choisissez entre courriel, t√©l√©gramme, discorde ou slack.

{% tabs %}
{% tab title="Email Notifications" %}
1. Visitez [https://beaconcha.in/](https://beaconcha.in/)
2. Inscrivez-vous ****pour un compte ****
3. V√©rifiez votre **e-mail**
4. Recherchez l'adresse publique de votre **validateur**
5. Ajoutez des validateurs √† votre liste de suivi en cliquant sur le **symbole de marque-page**.
{% endtab %}

{% tab title="Telegram Notifications" %}
1. Dans le menu de Grafana, s√©lectionnez **canaux de notification** sous l'ic√¥ne de la cloche. ![](../../.gitbook/assets/gra-noti.png)
2. Cliquer sur **Ajouter un canal**.
3. Donnez au canal de notification un nom ****.
4. S√©lectionnez **Telegram** dans la liste Type
5. Pour compl√©ter les **param√®tres de l'API Telegram**, un canal Telegram et un bot sont requis. Pour des instructions sur la mise en place d'un bot avec `@Botfather`, voir [cette section](https://core.telegram.org/bots#6-botfather) de la documentation Telegram.
6. Une fois termin√©, invitez le bot dans le canal nouvellement cr√©√©.
{% endtab %}

{% tab title="Discord Notifications" %}
1. Dans le menu de Grafana, s√©lectionnez **canaux de notification** sous l'ic√¥ne de la cloche. ![](../../.gitbook/assets/gra-noti.png)
2. Cliquer sur **Ajouter un canal**.
3. Ajouter un nom **** au canal de notification.
4. S√©lectionnez **Discord** dans la liste des types.
5. Pour terminer la configuration, un serveur Discord \(et un salon textuel disponible\) ainsi qu'une URL Webhook sont n√©cessaires. Pour des instructions sur la mise en place des Webhooks de Discord, voir [cette section](https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks) de leur documentation.
6. Entrez l'URL **du Webhook** dans le panneau des param√®tres de notification Discord.
7. Cliquez sur **Envoyer le test**, qui enverra un message de confirmation sur le canal Discord.
{% endtab %}

{% tab title="Slack Notifications" %}
1. Dans le menu de Grafana, s√©lectionnez **canaux de notification** sous l'ic√¥ne de la cloche. ![](../../.gitbook/assets/gra-noti.png)
2. Cliquer sur **Ajouter un canal**.
3. Ajouter un nom **** au canal de notification.
4. S√©lectionnez **Slack** dans la liste des types.
5. Pour des instructions sur la configuration des Webhooks entrants d'un Slack, voir [cette section](https://api.slack.com/messaging/webhooks) de leur documentation.
6. Entrez l'URL du Webhook Slack entrant dans le champ **URL**.
7. Cliquez sur **Envoyer le test**, ce qui poussera un message de confirmation vers le canal Slack.
{% endtab %}
{% endtabs %}

{% hint style="success" %}
üéâ F√©licitations pour la configuration de votre validateur ! Vous √™tes bien √† aller sur eth2.0.

Avez-vous trouv√© notre guide utile ? Faites-nous savoir avec un conseil et nous continuerons √† le mettre √† jour.

Utilisez [cointr.ee pour trouver nos adresses de don ](https://cointr.ee/coincashew). üôå

Tous les commentaires et toutes les demandes de pull sont tr√®s appr√©ci√©s. üòÉ

Sortez et discutez avec d'autres joueurs sur telegram @ [https://t.me/coincashew](https://t.me/coincashew)üåõ
{% endhint %}

## üßô‚ôÇ 11. Mise √† jour du Prysm

Red√©marrez la cha√Æne de balises et le validateur selon les proc√©dures normales de fonctionnement.

{% tabs %}
{% tab title="Systemd - Automated" %}
```text
sudo systemctl reload-or-restart beacon-chain
sudo systemctl reload-or-restart validator
```
{% endtab %}

{% tab title="CLI - Manual" %}
```bash
#Contr√¥le C pour quitter vos processus de balises et de validateurs 
#Appuyez sur la fl√®che vers le haut et entrez pour red√©marrer.
```
{% endtab %}
{% endtabs %}

## üß© 12. Mat√©riel de r√©f√©rence

Appr√©ciez le dur travail accompli par les gens aux liens suivants qui ont servi de fondement √† la cr√©ation de ce guide.

{% embed url="https://discord.gg/KSA7rPr" %}

{% embed url="https://launchpad.ethereum.org/" caption="" %}

{% embed url="https://prylabs.net/participate" %}

{% embed url="https://docs.prylabs.network/docs/getting-started/" %}

## üéâ 13. Liens bonus

### :ch√¢taignier: Tutoriels CoinCashew pour les autres clients ETH2

{% page-ref page="guide-how-to-stake-on-eth2-with-lighthouse.md" %}

{% page-ref page="guide-how-to-stake-on-eth2-with-teku-on-ubuntu.md" %}

{% page-ref page="guide-how-to-stake-on-eth2-with-nimbus.md" %}

{% page-ref page="guide-how-to-stake-on-eth2-with-lodestar.md" %}

### üß± Explorateurs de blocs ETH2

{% embed url="https://beaconcha.in" caption="" %}

{% embed url="https://beaconscan.com" caption="" %}

### üóí Derni√®re infos Eth2

{% embed url="https://www.reddit.com/r/ethstaker" caption="" %}

{% embed url="https://blog.ethereum.org" caption="" %}

{% embed url="http://invite.gg/ethstaker" caption="" %}

{% embed url="https://hackmd.io/@benjaminion/eth2\_news/" caption="" %}

## üî• 14. Astuces suppl√©mentaires utiles

### üõë 14.1 Sortie volontaire d'un validateur

{% hint style="info" %}
Utilisez cette commande pour signaler vos intentions d'arr√™ter de valider avec votre validateur. Cela signifie que vous ne voulez plus mettre en jeu avec votre validateur et que vous voulez d√©sactiver votre n≈ìud.

* La sortie volontaire prend un minimum de 2048 √©poques \(ou ~9 jours\). Il y a une file √† quitter et un d√©lai avant que votre validateur ne soit finalement quitt√©.
* Une fois qu'un validateur est sorti dans la phase 0, ce n'est pas r√©versible et vous ne pouvez plus red√©marrer la validation √† nouveau.
* Vos fonds ne seront pas disponibles pour le retrait avant la phase 1.5 ou plus.
* Une fois que votre validateur a quitt√© la file d'attente de sortie et qu'il est vraiment sorti, il est s√©curitaire de d√©sactiver votre noeud de balises et validateur.
{% endhint %}

```bash
$HOME/ prysm/prysm.sh comptes de validateur volontairement quitt√©s
```

### üîê 14.2 V√©rifiez votre phrase mn√©monique

En utilisant l'outil eth2deposit-cli, assurez-vous que vous pouvez r√©g√©n√©rer les m√™mes paires de cl√©s eth2 en restaurant vos `validator_keys`

```bash
./deposit existing-mn√©monic --chain mainnet
```

{% hint style="info" %}
Lorsque la **pubkey** est identique, cela signifie que votre **fichier de keystore** que vous avez correctement v√©rifi√© votre phrase mn√©monique. Les autres champs seront diff√©rents √† cause du salage.
{% endhint %}

### ü§ñ 14.3 Ajouter des validateurs suppl√©mentaires

En utilisant l'outil eth2deposit-cli, vous pouvez ajouter plus de validateurs en cr√©ant un nouveau fichier de donn√©es de d√©p√¥t et `validator_keys`

Par exemple, dans le cas o√π nous cr√©ions √† l'origine 3 validateurs mais que nous voulions maintenant ajouter 5 validateurs suppl√©mentaires, nous pourrions utiliser la commande suivante.

```bash
./deposit existing-mnemonic --validator_start_index 3 --num_validators 5 --chain mainnet
```

Compl√©tez les √©tapes du t√©l√©chargement du `deposit_data-#########.json` sur le site du pav√© de lancement.


---
description: å¿«é€Ÿä¿æŠ¤èŠ‚ç‚¹çš„æ­¥éª¤ã€‚
---

# æŒ‡å— \| ETH2 éªŒè¯ä¿¡æ ‡é“¾èŠ‚ç‚¹çš„å®‰å…¨æœ€ä½³åšæ³•

## ğŸ¤– å‰ææ¡ä»¶

* å·²å®‰è£… Ubuntu æœåŠ¡å™¨æˆ– Ubuntu æ¡Œé¢
* å·²å®‰è£… SSH æœåŠ¡å™¨
* ä¸€ä¸ª SSH å®¢æˆ·ç«¯æˆ–ç»ˆç«¯çª—å£è®¿é—®

å¦‚æœæ‚¨éœ€è¦å®‰è£… SSH æœåŠ¡å™¨ï¼Œè¯·å‚è€ƒï¼š

{% åµŒå…¥çš„ url="https://www.simportfied.guide/ubuntu/install-sh-server" %}

å¦‚æœæ‚¨çš„æ“ä½œç³»ç»Ÿéœ€è¦ä¸€ä¸ª SSH å®¢æˆ·ç«¯ï¼Œè¯·å‚è€ƒï¼š

{% åµŒå…¥çš„ url="https://www.howtogeek.com/311287/how-connect-to-an-ssh-server-from-windows-macos-or linux/" %}

## ğŸ§™:â™‚åˆ›å»ºä¸€ä¸ªéæ ¹ç”¨æˆ·ï¼Œæ‹¥æœ‰sudo æƒé™

{% hint style="info" %}
ä½¿ç”¨éæ ¹å¸æˆ·ç™»å½•åˆ°æ‚¨çš„æœåŠ¡å™¨çš„ä¹ æƒ¯ã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¿™å°†é˜²æ­¢æ–‡ä»¶è¢«æ„å¤–åˆ é™¤ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœroot ç”¨æˆ·é”™è¯¯åœ°è¿è¡Œï¼Œå‘½ä»¤ `rm` å¯ä»¥æ“¦é™¤æ•´ä¸ªæœåŠ¡å™¨ã€‚
{% endhint %}

{% hint style="danger" %}
ğŸ”¥**æç¤º**: ä¸è¦ç»å¸¸ä½¿ç”¨æ ¹å¸æˆ·ã€‚ ä½¿ç”¨ `su` æˆ– `sudo`, æ€»æ˜¯.
{% endhint %}

é€šè¿‡æ‚¨çš„ SSH å®¢æˆ·ç«¯åˆ°æ‚¨çš„æœåŠ¡å™¨

```bash
ssh username@server.public.ip.address
# ç¤ºä¾‹
# ssh myUsername@77.22.161.10
```

åˆ›å»ºä¸€ä¸ªå«åšetherumçš„æ–°ç”¨æˆ·

```text
sudo useradd -m -s /bin/bash ethereum
```

è®¾ç½®etherumç”¨æˆ·å¯†ç 

```text
sudo passwd ethereum
```

å°†etherumæ·»åŠ åˆ°sudoç»„

```text
sudo usermod -aG sudo ethereum
```

## ğŸ” **ç¦ç”¨ SSH å¯†ç éªŒè¯å¹¶ä»…ä½¿ç”¨ SSH å¯†é’¥**

{% hint style="info" %}
åŠ å¼ºSSHçš„åŸºæœ¬è§„åˆ™æ˜¯ï¼š

* æ²¡æœ‰è®¿é—®SSH çš„å¯†ç  \(ä½¿ç”¨ç§é’¥\)
* ä¸å…è®¸ SSH \(é€‚å½“ç”¨æˆ·åº”è¯¥åœ¨ SSH ä¸­ï¼Œç„¶å `su` æˆ– `sudo`\)
* å¯¹ç”¨æˆ·ä½¿ç”¨ `sudo` ä»¥ä¾¿å‘½ä»¤è¢«è®°å½•
* è®°å½•æœªç»æˆæƒçš„ç™»å½•å°è¯• \(å¹¶è€ƒè™‘è½¯ä»¶åˆ°å±è”½/å°ç¦ç”¨æˆ·ï¼Œä»–ä»¬è¯•å›¾è®¿é—®æ‚¨çš„æœåŠ¡å™¨å¤ªå¤šæ¬¡ï¼Œå¦‚å¤±è´¥2ban\)
* é”å®šSSH åˆ°åªéœ€è¦çš„ IP èŒƒå›´\(å¦‚æœä½ è§‰å¾—å®ƒå–œæ¬¢å®ƒ\)
{% endhint %}

åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šåˆ›å»ºæ–°çš„ SSH å¯†é’¥å¯¹ã€‚ åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œå®ƒã€‚ æ‚¨å°†è¢«è¦æ±‚è¾“å…¥è¦ä¿å­˜å¯†é’¥çš„æ–‡ä»¶åã€‚ è¿™å°†æ˜¯æ‚¨çš„ **å…³é”®å**ã€‚

æ‚¨é€‰æ‹© [ED25519 æˆ– RSA](https://goteleport.com/blog/comparing-ssh-keys/) å…¬é’¥ç®—æ³•ã€‚

{% tabs %}
{% tab title="ED25519" %}
```
ssh-keygen -t ed25519
```
{% endtab %}

{% tab title="RSA" %}
```bash
ssh-keygen -t rsa -b 4096
```
{% endtab %}
{% endtabs %}

å°†å…¬é’¥ä¼ è¾“åˆ°æ‚¨çš„è¿œç¨‹èŠ‚ç‚¹ã€‚ æ­£ç¡®æ›´æ–° **keyname.pub**ã€‚

```bash
ssh-copy-id -i $HOME/.ssh/keyname.pub ethereum@server.public.ip.address
```

ä½¿ç”¨æ‚¨çš„æ–°ç”¨æˆ·ç™»å½•

```text
ssh ethereum@server.public.ip.address
```

ç¦ç”¨åŸºäºæ ¹ç™»å½•å’Œå¯†ç çš„ç™»å½•ã€‚ ç¼–è¾‘ `/etc/ssh/sshd_config æ–‡ä»¶`

```text
sudo nano /etc/ssh/sshd_config
```

æ‰¾åˆ° **ä¸ªæŒ‘æˆ˜å“åº”èº«ä»½éªŒè¯** å¹¶æ›´æ–°ä¸º no

```text
ChallengeResponseAuthentication no
```

æ‰¾åˆ° **ä¸ªå¯†ç è®¤è¯** æ›´æ–°è‡³æ— 

```text
PasswordAuthentication no
```

æ‰¾åˆ° **PermitRootç™»å½•** å¹¶æ›´æ–°ä¸ºæ— 

```text
PermitRootLogin no
```

æ‰¾åˆ° **PermittemptyPasswords** å¹¶æ›´æ–°ä¸º no

```text
PermitEmptyPasswords no
```

**å¯é€‰çš„**: å®šä½ **ç«¯å£** å¹¶è‡ªå®šä¹‰æ‚¨çš„ **éšæœº** ç«¯å£ã€‚

{% hint style="info" %}
ä½¿ç”¨ **éšæœº** ç«¯å£ \# ä» 1024 æ¨é€åˆ°49141 ã€‚ [æ£€æŸ¥å¯èƒ½å‘ç”Ÿçš„å†²çªã€‚ ](https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)
{% endhint %}

```bash
Port <port number>
```

éªŒè¯æ‚¨æ–°çš„ SSH é…ç½®çš„è¯­æ³•ã€‚

```text
sudo sshd -t
```

å¦‚æœè¯­æ³•éªŒè¯æ²¡æœ‰é”™è¯¯ï¼Œåˆ™é‡æ–°åŠ è½½ SSH è¿›ç¨‹

```text
sudo service sshd reload
```

éªŒè¯ç™»å½•ä»ç„¶å·¥ä½œ

{% tabs %}
{% tab title="Standard SSH Port 22" %}
```text
ssh ethereum@server.public.ip.address
```
{% endtab %}

{% tab title="Custom SSH Port" %}
```bash
ssh ethereum@server.public.ip.address -p <custom port number>
```
{% endtab %}
{% endtabs %}

{% hint style="info" %}
æˆ–è€…ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨ã€‚ å¦‚æœæ‚¨ä½¿ç”¨äº†è‡ªå®šä¹‰ SSH ç«¯å£ï¼Œæ·»åŠ  `-p <port#>` æ ‡è®°ã€‚

```bash
ssh -i <path to your SSH_key_name.pub> ethereum@server.public.ip.address
```
{% endhint %}

## ğŸ¤– **æ›´æ–°ä½ çš„ç³»ç»Ÿ**

{% hint style="warning" %}
éå¸¸é‡è¦çš„æ˜¯ï¼Œè¦ä½¿æ‚¨çš„ç³»ç»Ÿè·Ÿä¸Šæœ€æ–°çš„è¡¥ä¸ï¼Œä»¥é˜²æ­¢é—¯å…¥è€…è®¿é—®æ‚¨çš„ç³»ç»Ÿã€‚
{% endhint %}

```bash
sudo apt-get update -y && sudo apt-get upgrade -y
sudo apt-get autoremove
sudo apt-get autoclean
```

å¯ç”¨è‡ªåŠ¨æ›´æ–°ï¼Œæ‚¨ä¸å¿…æ‰‹åŠ¨å®‰è£…ã€‚

```text
sudo apt-get install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

## ğŸ» ç¦ç”¨æ ¹å¸æˆ·

ç³»ç»Ÿç®¡ç†å‘˜ä¸åº”ç»å¸¸ä»¥ root èº«ä»½ç™»å½•ä»¥ç»´æŠ¤æœåŠ¡å™¨å®‰å…¨ã€‚ ç›¸åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ sudo æ‰§è¡Œè¦æ±‚ä½çº§ç‰¹æƒã€‚

```bash
# è¦ç¦ç”¨æ ¹å¸æˆ·ï¼Œåªéœ€ä½¿ç”¨ -l é€‰é¡¹ã€‚
sudo passwd -l root
```

```bash
# å¦‚æœç”±äºæŸäº›æœ‰æ•ˆçš„åŸå› ï¼Œæ‚¨éœ€è¦é‡æ–°å¯ç”¨å¸æˆ·ï¼Œåªéœ€ä½¿ç”¨ -u é€‰é¡¹ã€‚
sudo passwd -u root
```

## ğŸ›  è®¾ç½® SSH çš„ä¸¤æ­¥éªŒè¯ \[å¯é€‰\]

{% hint style="info" %}
SSHæ˜¯å®‰å…¨çš„å¤–å£³ï¼Œç»å¸¸ç”¨äºè®¿é—®è¿œç¨‹Linuxç³»ç»Ÿã€‚ å› ä¸ºæˆ‘ä»¬ç»å¸¸ä½¿ç”¨å®ƒæ¥è¿æ¥åŒ…å«é‡è¦æ•°æ®çš„è®¡ç®—æœºï¼Œå»ºè®®æ·»åŠ å¦ä¸€ä¸ªå®‰å…¨å±‚ã€‚ è¿™é‡Œæ˜¯åŒé‡èº«ä»½éªŒè¯ \(_2FA_\)ã€‚
{% endhint %}

```text
sudo apt install libpam-google-authenticator -y
```

è¦ä½¿ç”¨ Google èº«ä»½éªŒè¯å™¨ PAM æ¨¡å—ï¼Œç¼–è¾‘ `/etc/pam.d/sshd` æ–‡ä»¶ï¼š

```text
sudo nano /etc/pam.d/sshd
```

å¢åŠ ä»¥ä¸‹è¡Œï¼š

```text
auth required pam_google_authenticator.so
```

ç°åœ¨æ‚¨éœ€è¦é‡å¯ `sshd` å®ˆæŠ¤ç¨‹åºä½¿ç”¨ï¼š

```text
sudo systemctl restart sshd.service
```

ä¿®æ”¹ `/etc/ssh/sshd_config`

```text
sudo nano /etc/ssh/sshd_config
```

æ‰¾åˆ° **ä¸ªæŒ‘æˆ˜å“åº”èº«ä»½éªŒè¯** å¹¶æ›´æ–°ä¸º yes

```text
ChallengeResponseAuthentication yes
```

æ‰¾åˆ° **UsePAM** å¹¶æ›´æ–°ä¸ºæ˜¯çš„

```text
UsePAM yes
```

ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºã€‚

è¿è¡Œ **Google èº«ä»½éªŒè¯å™¨** å‘½ä»¤ã€‚

```text
google-authenticator
```

å®ƒä¼šå‘æ‚¨æå‡ºä¸€ç³»åˆ—é—®é¢˜ï¼Œè¿™é‡Œæ˜¯æ¨èçš„é…ç½®ï¼š

* è®©ä»¤ç‰Œâ€œæ—¶é—´åŸºç¡€â€ï¼šâ€œæ˜¯â€
* æ›´æ–° `.google_author` æ–‡ä»¶ï¼šæ˜¯
* ä¸å…è®¸å¤šæ¬¡ä½¿ç”¨ï¼šæ˜¯
* å¢åŠ æœ€åˆç”Ÿæˆæ—¶é—´é™åˆ¶ï¼šæ— 
* å¯ç”¨é¢‘ç‡é™åˆ¶ï¼šæ˜¯

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°è¿‡ç¨‹ä¸­å‡ºç°çš„å·¨å‹äºŒç»´ç ã€‚ ä¸‹é¢æ˜¯å¦‚æœæ‚¨æ— æ³•è®¿é—®æ‚¨çš„æ‰‹æœºæ—¶å°†ä½¿ç”¨çš„ç´§æ€¥éªŒè¯ç ï¼šå°†å…¶å†™åœ¨çº¸ä¸Šï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚

ç°åœ¨åœ¨æ‚¨çš„æ‰‹æœºä¸Šæ‰“å¼€è°·æ­Œèº«ä»½éªŒè¯å™¨å¹¶æ·»åŠ æ‚¨çš„å¯†é’¥ä»¥ä½¿ä¸¤æ­¥éªŒè¯æ­£å¸¸ã€‚

{% hint style="danger" %}
**Note**: If you are enabling 2FA on a remote machine that you access over SSH you need to follow **steps 2 and 3** of [this tutorial](https://www.digitalocean.com/community/tutorials/how-to-set-up-multi-factor-authentication-for-ssh-on-ubuntu-18-04) to make 2FA work.
{% endhint %}

## ğŸ§© å®‰å…¨å…±äº«å†…å­˜

{% hint style="info" %}
æ‚¨åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¿æŠ¤ç³»ç»Ÿä¸Šå…±äº«çš„ [å†…å­˜](https://www.lifewire.com/what-is-random-access-memory-ram-2618159)ã€‚ å¦‚æœæ‚¨ä¸æ¸…æ¥šï¼Œå…±äº«å†…å­˜å¯ä»¥ç”¨äºæ”»å‡»è¿è¡Œä¸­çš„æœåŠ¡ã€‚ å› æ­¤ï¼Œç¡®ä¿ç³»ç»Ÿå†…å­˜çš„è¿™ä¸€éƒ¨åˆ†ã€‚

è¦äº†è§£æ›´å¤šå…³äºå®‰å…¨å…±äº«å†…å­˜çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯» [techRepublic.comæ–‡ç« ](https://www.techrepublic.com/article/how-to-enable-secure-shared-memory-on-ubuntu-server/)ã€‚
{% endhint %}

{% hint style="warning" %}
### ä¸€ä¸ªä¾‹å¤–æƒ…å†µ

æ‚¨å¯èƒ½æœ‰ç†ç”±éœ€è¦å°†å†…å­˜ç©ºé—´æŒ‚è½½åœ¨è¯»/å†™æ¨¡å¼\(ä¾‹å¦‚ä¸€ä¸ª **DappNode** è¿™æ ·çš„ç‰¹å®šæœåŠ¡å™¨åº”ç”¨ç¨‹åºéœ€è¦æ­¤ç§è®¿é—®å…±äº«å†…å­˜æˆ–è¯¸å¦‚Google Chrome\ç­‰æ ‡å‡†åº”ç”¨ç¨‹åº)ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ fstab æ–‡ä»¶çš„ä¸‹åˆ—è¡Œï¼Œå¹¶åœ¨ä¸‹é¢åŠ ä»¥è¯´æ˜ã€‚

```text
none /run/shm tmpfs rw,noexec,nosuid,nodev 0 0
```

ä¸Šé¢çš„è¡Œå°†æŒ‚è½½å…±äº«å†…å­˜ï¼Œå¸¦æœ‰è¯»/å†™è®¿é—®æƒé™ï¼Œä½†æ²¡æœ‰æ‰§è¡Œç¨‹åºçš„æƒé™ã€‚ æ›´æ”¹è¿è¡Œç¨‹åºçš„ UID æˆ–åœ¨å‘½åç©ºé—´ä¸­åˆ›å»ºæ–¹å—æˆ–å­—ç¬¦è®¾å¤‡ã€‚ è¿™æ˜¯é»˜è®¤è®¾ç½®çš„å‡€å®‰å…¨æ€§æ”¹è¿›ã€‚

### è°¨æ…ä½¿ç”¨

æœ‰ä¸€äº›è¯•ç”¨ç‰ˆå’Œé”™è¯¯ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä¸€äº›åº”ç”¨ç¨‹åº\(**åƒDappNode**\) åœ¨åªè¯»æ¨¡å¼ä¸‹æ— æ³•ä½¿ç”¨å…±äº«å†…å­˜ã€‚ ä¸ºäº†æœ€é«˜çš„å®‰å…¨æ€§ï¼Œå¦‚æœä¸æ‚¨çš„åº”ç”¨ç¨‹åºå…¼å®¹ï¼Œæ‰§è¡Œæ­¤å®‰å…¨å…±äº«å†…å­˜è®¾ç½®æ˜¯å€¼å¾—åŠªåŠ›çš„ã€‚

èµ„æ–™æ¥æºï¼š [techRepublic.com](https://www.techrepublic.com/article/how-to-enable-secure-shared-memory-on-ubuntu-server/)
{% endhint %}

ç¼–è¾‘ `/etc/fstab`

```text
sudo nano /etc/fstab
```

æ’å…¥ä»¥ä¸‹è¡Œåˆ°æ–‡ä»¶åº•éƒ¨å¹¶ä¿å­˜/å…³é—­. å°†å…±äº«å†…å­˜è®¾ç½®ä¸ºåªè¯»æ¨¡å¼ã€‚

```text
tmpfs    /run/shm    tmpfs    ro,noexec,nosuid    0 0
```

é‡å¯èŠ‚ç‚¹ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚

```text
sudo reboot
```

## :chainsï¼š**å®‰è£…å¤±è´¥2ban**

{% hint style="info" %}
Fail2ban æ˜¯ä¸€ä¸ªé˜²æ­¢ä¾µå…¥çš„ç³»ç»Ÿï¼Œç”¨äºç›‘æµ‹æ—¥å¿—æ–‡ä»¶å’Œæœç´¢ä¸å¤±è´¥ç™»å½•å°è¯•ç›¸å¯¹åº”çš„ç‰¹å®šæ¨¡å¼ã€‚ å¦‚æœä»æŒ‡å®šçš„ IP åœ°å€\(åœ¨æŒ‡å®šæ—¶é—´å†…\)æ£€æµ‹åˆ°ä¸€å®šæ•°é‡çš„å¤±è´¥ç™»å½•ï¼Œ å¤±è´¥2å°ç¦æ–¹å—ä»è¯¥IPåœ°å€è®¿é—®ã€‚
{% endhint %}

```text
sudo apt-get install fail2ban -y
```

ç¼–è¾‘ç›‘è§†SSHç™»å½•çš„é…ç½®æ–‡ä»¶ã€‚

```text
sudo nano /etc/fail2ban/jail.local
```

å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°æ–‡ä»¶åº•éƒ¨ã€‚

{% hint style="info" %}
ğŸ”¥ **å°†IPåœ°å€æç¤º**: `å¿½ç•¥` å‚æ•°æ¥å—IPåœ°å€ æ‚¨å¯ä»¥æŒ‡å®šå…è®¸è¿æ¥çš„ IP èŒƒå›´æˆ– DNS ä¸»æœº. è¿™æ˜¯æ‚¨æƒ³è¦æŒ‡å®šæœ¬åœ°æœºå™¨ï¼Œæœ¬åœ°IPèŒƒå›´æˆ–æœ¬åœ°åŸŸåï¼Œç”¨ç©ºæ ¼éš”å¼€ã€‚

```bash
# Example
ignoreip = 192.168.1.0/24 127.0.0.1/8 
```
{% endhint %}

```bash
[sshd]
enabled = true
port = <22 or your random port number>
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
# whitelisted IP addresses
ignoreip = <list of whitelisted IP address, your local daily laptop/pc>
```

ä¿å­˜/å…³é—­æ–‡ä»¶ã€‚

é‡å¯å¤±è´¥2å°ç¦ä»¥ä½¿è®¾ç½®ç”Ÿæ•ˆã€‚

```text
sudo systemctl restart fail2ban
```

## ğŸ§±**é…ç½®ä½ çš„é˜²ç«å¢™**

æ ‡å‡†çš„ UFW é˜²ç«å¢™å¯ä»¥ç”¨æ¥æ§åˆ¶æ‚¨èŠ‚ç‚¹çš„ç½‘ç»œè®¿é—®ã€‚

ä»»ä½•æ–°å®‰è£…éƒ½å°†ç¦ç”¨ ufw é»˜è®¤ã€‚ é€šè¿‡ä»¥ä¸‹è®¾ç½®å¯ç”¨å®ƒã€‚

* ç«¯å£ 22 \(æˆ–æ‚¨çš„éšæœºç«¯å£ \#\) SSH è¿æ¥
* P2p æµé‡çš„ç«¯å£
  * ç¯å¡”ä½¿ç”¨ç«¯å£ 9000 tcp/udp
  * Teku ä½¿ç”¨ç«¯å£ 9000 tcp/udp
  * Prysmä½¿ç”¨ç«¯å£ 13000 tcp å’Œ 12000 udp
  * Nimbusä½¿ç”¨ç«¯å£ 9000 tcp/udp
  * Lodestarä½¿ç”¨ç«¯å£ 30607 tcp å’Œ 9000 udp
* ç«¯å£ 303 tcp/udp eth1 èŠ‚ç‚¹
* Grafana çš„ 3000 tcp ç«¯å£
* Prometheuså¯¼å‡ºæ•°æ®çš„ç«¯å£ 900 tcp \(optional\)

{% tabs %}
{% tab title="Lighthouse" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}

{% tab title="Prysm" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 13000/tcp
sudo ufw allow 12000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}

{% tab title="Teku" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}

{% tab title="Lodestar" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 30607/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
ä¸è¦å°†Grafana \(porter 3000\) å’Œ Prometheus ç«¯ç‚¹ \(ç«¯å£ 90\) æ³„éœ²åˆ°å…¬å…±äº’è”ç½‘ï¼Œå› ä¸ºè¿™ä¼šå¼•èµ·æ–°çš„æ”»å‡»è¡¨é¢ï¼ ä¸€ä¸ªå®‰å…¨çš„è§£å†³æ–¹æ¡ˆå°†æ˜¯é€šè¿‡ Wireguard çš„ ssh éš§é“è®¿é—®Grafana ã€‚
{% endhint %}

ä»…åœ¨å®¶åº­è·¯ç”±å™¨é˜²ç«å¢™æˆ–å…¶ä»–ç½‘ç»œé˜²ç«å¢™åçš„æœ¬åœ°ä¸»æ¥¼å®‰è£…ç«¯å£æ‰“å¼€ä»¥ä¸‹ç«¯å£ã€‚

\*\*\*ğŸ”¥ **åœ¨ VPS/cloud èŠ‚ç‚¹ä¸Šæ‰“å¼€è¿™äº›ç«¯å£æ˜¯å±é™©çš„ã€‚**

```bash
sudo ufw allow 3000/tcp
sudo ufw allow 9090/tcp
```

ç¡®è®¤è®¾ç½®å·²ç”Ÿæ•ˆã€‚
> ```csharp
     To                         Action      From
     --                         ------      ----
[ 1] 22/tcp                     ALLOW IN    Anywhere
# SSH
[ 2] 3000/tcp                   ALLOW IN    Anywhere
# Grafana
[ 3] 9000/tcp                   ALLOW IN    Anywhere
# eth2 p2p traffic
[ 4] 9090/tcp                   ALLOW IN    Anywhere
# Prometheus
[ 5] 30303/tcp                  ALLOW IN    Anywhere
# eth1 node
[ 6] 22/tcp (v6)                ALLOW IN    Anywhere (v6)
# SSH
[ 7] 3000/tcp (v6)              ALLOW IN    Anywhere (v6)
# Grafana
[ 8] 9000/tcp (v6)              ALLOW IN    Anywhere (v6)
# eth2 p2p traffic
[ 9] 9090/tcp (v6)              ALLOW IN    Anywhere (v6)
# Prometheus
[10] 30303/tcp (v6)             ALLOW IN    Anywhere (v6)
# eth1 node
```

**\[ å¯é€‰ä½†æ¨è\]** ç™½åå•\(æˆ–å…è®¸ä»ç‰¹å®šIP\è¿›è¡Œè¿æ¥) å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®ã€‚

```bash
sudo ufw allow from <your local daily laptop/pc>
# Example
# sudo ufw allow from 192.168.50.22
```

{% hint style="info" %}
 ğŸŠ **ç«¯å£è½¬å‘æç¤º:** æ‚¨éœ€è¦è½¬å‘å¹¶æ‰“å¼€ç«¯å£åˆ°æ‚¨çš„éªŒè¯å™¨ã€‚ éªŒè¯å®ƒä½¿ç”¨ [https://www.yugetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) æˆ– [https://canyousee.org/](https://canyouseeme.org/)ã€‚
{% endhint %}

## :phone_receiver: éªŒè¯ç›‘å¬ç«¯å£

å¦‚æœä½ æƒ³è¦ç»´æŠ¤ä¸€ä¸ªå®‰å…¨çš„æœåŠ¡å™¨ï¼Œä½ åº”è¯¥æ¯æ¬¡ä¸€æ¬¡éªŒè¯ç›‘å¬ç½‘ç»œç«¯å£ã€‚ è¿™å°†ä¸ºæ‚¨æä¾›æœ‰å…³æ‚¨ç½‘ç»œçš„åŸºæœ¬ä¿¡æ¯ã€‚

```bash
sudo ss -tulpn
# ç¤ºä¾‹è¾“å‡ºã€‚ ç¡®ä¿ç«¯å£å·æ˜¯æ­£ç¡®çš„ã€‚
# Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port Process
# tcp ListeN 0128 127. 0.0.1:5052 0.0.0ã€‚ * ç”¨æˆ·:("ç¯å¡”",pid=12160) d=22)
tcp LISTEN 0 128 127ã€‚ 0.1:5054 0.0.0.0ï¼š* ç”¨æˆ·:("ç¯å¡”",pid=12160) d=23)
# tcp LISTEN 0 1024 0ã€‚ 0.0:9000 0.0.0ã€‚ * ç”¨æˆ·:("ç¯å¡”",pid=12160) d=21)
# udp UNCONN 0 *ï¼š30303 *ï¼šusers:("geth", id=22117ã€‚ d=158)
# tcp LISTEN 0 4096 *ï¼š30303 *ï¼šusers:("geth", id=22117,fd=156))
```

æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `netstat`

```bash
sudo netstat -tulpn
# ç¤ºä¾‹è¾“å‡ºã€‚ ç¡®ä¿ç«¯å£å·æ˜¯æ­£ç¡®çš„ã€‚
# Proto Recv-Q Send-Q æœ¬åœ°åœ°å€å¼‚å¸¸åœ°å€çŠ¶æ€ PID/ç¨‹åºå
# tcp 0 0 127ã€‚ 0.0.1:5052 0.0.0ã€‚ * * ISTEN 12160/lightthouse
# tcp 0 0 127ã€‚ 0ã€‚ :5054 0.0.0ã€‚ * * ISTEN 12160/lightthouse
# tcp 0 0 0ã€‚ 0.0:9000 0.0.0ã€‚ * * LISTEN 12160/lightthouse
# tcp6 0 0 0 ::::::::30303 :::* LISTEN 22117/geth
# udp6 0 0 :::30303 :*::* LISTEN 22117/geth
```

## ğŸ‘©ğŸš€ **ä½¿ç”¨** ç³»ç»Ÿç”¨æˆ·å¸æˆ· - æœ€å°‘ç‰¹æƒåŸåˆ™ \[é«˜çº§ç”¨æˆ·/å¯é€‰\]

{% hint style="info" %}
**ä»…æ¨èé«˜çº§ç”¨æˆ·**

**ç‰¹æƒæœ€å°‘çš„åŸåˆ™**: æ¯ä¸ªeth2 è¿›ç¨‹éƒ½è¢«åˆ†é…ä¸€ä¸ª _ç³»ç»Ÿç”¨æˆ·å¸æˆ·_ å¹¶ä¸”è¿è¡Œçš„æƒé™æœ€å°‘æ˜¯è¿è¡Œçš„æƒé™æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ è¿™ç§æœ€ä½³åšæ³•ä¿æŠ¤äººä»¬å…å—åœ¨æŸä¸€ç‰¹å®šè¿‡ç¨‹ä¸­å‘ç°çš„è„†å¼±æ€§æˆ–å‰¥å‰Šå¯èƒ½ä½¿äººä»¬èƒ½å¤Ÿè¿›å…¥å…¶ä»–ç³»ç»Ÿè¿‡ç¨‹çš„æƒ…å†µã€‚
{% endhint %}

```bash
# ä¸ºeth1 æœåŠ¡åˆ›å»ºç³»ç»Ÿç”¨æˆ·å¸æˆ·
sudo adduser --system --no-create-home eth1

# ä¸ºéªŒè¯æœåŠ¡åˆ›å»ºç³»ç»Ÿç”¨æˆ·å¸æˆ·
sudo adduser --system --no-create-home validator

# ä¸ºä¿¡æ ‡é“¾æœåŠ¡åˆ›å»ºç³»ç»Ÿç”¨æˆ·å¸æˆ·
sudo adduser --system --no-create-home beacon-chain

# ä¸ºslasher åˆ›å»ºç³»ç»Ÿç”¨æˆ·å¸æˆ·
sudo adduser --system --no-create-home slasher
```

{% hint style="danger" %}
\*\*\*ğŸ”¥ **ä¸ºé«˜çº§ç”¨æˆ·æä¾›çš„æŠ¤æ³•**

å¦‚æœæ‚¨å†³å®šä½¿ç”¨ **ç³»ç»Ÿç”¨æˆ·å¸æˆ·**ï¼Œè¯·è®°ä½ç”¨ç›¸åº”çš„ç”¨æˆ·æ›¿æ¢ **ç³»ç»Ÿå•ä½æ–‡ä»¶**ã€‚

```bash
# ä¿¡æ ‡é“¾çš„ç¤ºä¾‹ã€‚æœåŠ¡å•å…ƒæ–‡ä»¶
ç”¨æˆ· = ä¿¡æ ‡é“¾ã€‚
```

æ­¤å¤–ï¼Œç¡®ä¿æ­£ç¡®çš„ **æ–‡ä»¶æ‰€æœ‰æƒ** å·²ç»åˆ†é…ç»™æ‚¨çš„ **ç³»ç»Ÿç”¨æˆ·å¸æˆ·**ã€‚

```bash
# prysm éªŒè¯å™¨å¯†ç æ–‡ä»¶ç¤ºä¾‹
sudo chown validator:validator -R $HOME/.eth2validators/validators-password.txt
```
{% endhint %}

## :sparkls: é¢å¤–éªŒè¯èŠ‚ç‚¹æœ€ä½³åšæ³•

<table>
  <thead>
    <tr>
      <th style="text-align:left"></th>
      <th style="text-align:left"></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">å»ºç«‹ç½‘ç»œ</td>
      <td style="text-align:left">
        <p></p>
        <p>å°†é™æ€å†…éƒ¨IPåˆ†é…ç»™æ‚¨çš„éªŒè¯å™¨èŠ‚ç‚¹å’Œæ¯æ—¥ç¬”è®°æœ¬/PCã€‚
          è¿™ä¸ufw å’Œ Fail2ban&apos;s ç™½åå•
          åŠŸèƒ½æ˜¯æœ‰ç”¨çš„ã€‚ é€šå¸¸ï¼Œè¿™å¯ä»¥åœ¨æ‚¨çš„è·¯ç”±å™¨&apos;sè®¾ç½®ä¸­è¿›è¡Œé…ç½®ã€‚
          è¯·å‚è€ƒæ‚¨çš„è·¯ç”±å™¨&apos;s æ‰‹å†Œäº†è§£è¯´æ˜ã€‚</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">ç”µæºæ•…éšœ</td>
      <td style="text-align:left">åœ¨åœç”µçš„æƒ…å†µä¸‹ï¼Œä½ æƒ³è¦ä½ çš„éªŒè¯æœºå™¨åœ¨
        å¯ç”¨æ—¶é‡æ–°å¯åŠ¨ã€‚ åœ¨ BIOS è®¾ç½®ä¸­ï¼Œæ›´æ”¹ç”µæºä¸¢å¤±æ—¶çš„ <b>è¿˜åŸ</b> æˆ– <b>ç”µæºä¸¢å¤±å</b> è®¾ç½®
        ä»¥ä¾¿ç»§ç»­å¼€å¯ã€‚ æ›´å¥½çš„æ˜¯ï¼Œå®‰è£…ä¸€ä¸ªä¸å¯ä¸­æ–­çš„ç”µæº(UPS)ã€‚</td>
    </tr>
    <tr>
      <td style="text-align:left">æ¸…é™¤åŸºç¡€å†å²è®°å½•</td>
      <td style="text-align:left">
        <p>å½“æŒ‰ä¸‹ä¸Šç®­å¤´é”®æ—¶ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å…ˆå‰çš„å‘½ä»¤å¯èƒ½åŒ…å«
          ä¸ªæ•æ„Ÿæ•°æ®ã€‚ è‹¥è¦æ¸…é™¤æ­¤é¡¹ï¼Œè¯·è¿è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
        <p><code>shred -u ~/.bash_history &amp;&amp; tount ~/.bash_history</code>
        </p>
      </td>
    </tr>
  </tbody>
</table>

{% hint style="info" %}
è¯·åŠ¡å¿…æŸ¥çœ‹ [æ¸…å• \| å¦‚ä½•ç¡®è®¤ä¸€ä¸ªå¥åº·çš„ ETH2 éªŒè¯å™¨ã€‚](guide-or-how-to-setup-a-validator-on-eth2-mainnet/checklist-or-how-to-confirm-a-healthy-functional-eth2-validator.md)
{% endhint %}

## ğŸ¤– é€šè¿‡æ„å»ºä¸€ä¸ªéªŒè¯å™¨æ¥å¼€å§‹èˆè¹ˆã€‚

### ä¸ºæˆ‘ä»¬çš„ [ä¸»è¦æŒ‡å—](guide-or-how-to-setup-a-validator-on-eth2-mainnet/) è®¿é—®æ­¤å¤„ï¼Œä¸ºæˆ‘ä»¬çš„ [æµ‹è¯•ç½‘æŒ‡å—](guide-or-how-to-setup-a-validator-on-eth2-testnet.md) è®¿é—®æ­¤å¤„ã€‚

{% hint style="success" %}
æ­å–œæ‚¨å®Œæˆäº†æŒ‡å—ã€‚ âœ¨

ä½ è§‰å¾—æˆ‘ä»¬çš„æŒ‡å—æœ‰ç”¨å—ï¼Ÿ å‘æˆ‘ä»¬å‘é€ä¸€ä¸ªå¸¦æœ‰æç¤ºçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸æ–­æ›´æ–°å®ƒã€‚

å®ƒçœŸæ­£æ¿€åŠ±æˆ‘ä»¬ç»§ç»­åˆ›å»ºæœ€å¥½çš„åŠ å¯†æŒ‡å—ã€‚

ä½¿ç”¨ [cointr.ee æ‰¾åˆ°æˆ‘ä»¬çš„æèµ  ](https://cointr.ee/coincashew)ä¸ªåœ°å€ã€‚ ğŸ™

ä»»ä½•åé¦ˆå’Œæ‰€æœ‰æ‹‰å–è¯·æ±‚éƒ½éå¸¸æ„Ÿæ¿€ã€‚ ğŸŒ›

åœ¨ Discord ä¸ŠæŒ‚èµ·å¹¶ä¸ä»–äººèŠå¤© @

[https://discord.gg/w8Bx8W2HPW](https://discord.gg/w8Bx8W2HPW)ğŸ˜ƒ
{% endhint %}

ğŸŠ **2020-12 æ›´æ–°**: æ„Ÿè°¢æ‰€æœ‰ [Gitcoin](https://gitcoin.co/grants/1653/eth2-staking-guides-by-coincashew) è´¡çŒ®è€… æ‚¨å¯ä»¥é€šè¿‡ [äºŒæ¬¡ä¾›èµ„](https://vitalik.ca/general/2019/12/07/quadratic.html) åšå‡ºè´¡çŒ®å¹¶äº§ç”Ÿé‡å¤§å½±å“ã€‚ èèµ„å·²å®Œæˆï¼ è°¢è°¢ï¼:folded_handsï¼š

{% embed url="https://gitcoin.co/grants/1653/eth2-staking-guides-by-coincashew" %}

## ğŸš€ å‚è€ƒ

{% embed url="https://med.com/@BaneBiddix/howto harden-ubuntu-18-04-server-ffc4b6658fe7" caption="" %}

{% åµŒå…¥çš„ url="https://linux-audit.com/ubuntu-server-hardening-guide-Quice-and-secure/" caption="" %}

{% embed url="https://www.digitalocean.com/community/tutorials/how to harden-openssh-on-ubuntu-18-04" caption="" %}

{% åµŒå…¥çš„ url="https://ubuntu.com/tutorials/configure-ssh-2fa\#1-overview.â€æ ‡é¢˜="" %}

{% åµŒå…¥çš„ url="https://linuxize.com/post/install-configure-fail2ban-on-ubuntu-20-04/" %}

[https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3\#file-ubuntu-hardening-md](https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3#file-ubuntu-hardening-md)

{% åµŒå…¥çš„ url="https://www.lifewire.com/harden-ubuntu-server-security,4178243"å­—å¹•="" %}

{% åµŒå…¥çš„ url="https://www.ubuntupit.com/best-linux-hardening-security-tips-a-complesive-checklist/" caption="" %}


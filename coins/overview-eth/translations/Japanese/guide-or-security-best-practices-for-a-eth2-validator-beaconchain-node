---
description: ãƒãƒ¼ãƒ‰ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚
---

# ã‚¬ã‚¤ãƒ‰ \| ETH2æ¤œè¨¼ç”¨ãƒ“ãƒ¼ã‚³ãƒ³ãƒã‚§ãƒ¼ãƒ³ãƒãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦

## ğŸ¤– äº‹å‰è¦ä»¶

* Ubuntu Server ã¾ãŸã¯ Ubuntu Desktop ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ
* SSHã‚µãƒ¼ãƒãƒ¼ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ
* SSHã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

SSH ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„:

{% embed url="https://www.simplicified.guide/ubuntu/install-ssh-server" %}

ãŠä½¿ã„ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã«SSHã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¿…è¦ãªå ´åˆã¯ã€ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„:

{% embed url="https://www.howto-to-an-ssh-server-from-windows-or-linux/" %}

## ğŸ§™â™‚sudo æ¨©é™ã‚’æŒã¤é root ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ

{% hint style="info" %}
é root ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ç¿’æ…£ã‚’ä½œã£ã¦ãã ã•ã„ã€‚ ã“ã‚Œã¯é–“é•ã„ã‚’çŠ¯ã—ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¤ã£ã¦å‰Šé™¤ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚ ä¾‹ãˆã°ã€ã‚³ãƒãƒ³ãƒ‰ `rm` ã¯ã€rootãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–“é•ã£ã¦å®Ÿè¡Œã—ãŸå ´åˆã€ã‚µãƒ¼ãƒãƒ¼å…¨ä½“ã‚’æ¶ˆå»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

{% hint style="danger" %}
ğŸ”¥**ãƒ’ãƒ³ãƒˆ**: root ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ—¥å¸¸çš„ã«ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚ `su` ã¾ãŸã¯ `sudo`ã‚’å¸¸ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

SSH ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã« SSH

```bash
ssh username@server.public.ip.address
# example
# ssh myUsername@77.22.161.10
```

ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ã¨ã„ã†æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ

```text
sudo useradd -m -s /bin/bash eterium
```

ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹

```text
sudo passwd ethereum
```

sudoã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ã‚’è¿½åŠ 

```text
sudo usermod -aG sudo ethereum
```

## ğŸ” **SSHãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’ç„¡åŠ¹ã«ã—ã€SSHã‚­ãƒ¼ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹**

{% hint style="info" %}
SSHã‚’ç¡¬åŒ–ã™ã‚‹åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

* SSH ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆç§˜å¯†éµã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼‰ã€‚
* root ã‹ã‚‰ SSH ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ (é©åˆ‡ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ SSH ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ `su` ã¾ãŸã¯ `sudo`\)
* ãƒ¦ãƒ¼ã‚¶ã«ã¯ `sudo` ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œã‚’è¨˜éŒ²ã™ã‚‹ \(fail2ban\ã®ã‚ˆã†ã«ã€ã‚µãƒ¼ãƒãƒ¼ã«ä½•åº¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯/ç¦æ­¢ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æ¤œè¨ã—ã¦ãã ã•ã„)
* SSHã‚’ãƒ­ãƒƒã‚¯ã—ã€å¿…è¦ãªIPã®ç¯„å›²ã«ã®ã¿æ¥ç¶šã—ã¾ã™ï¼ˆæ°—ã«å…¥ã£ãŸå ´åˆã¯ï¼‰ã€‚
{% endhint %}

ãƒ­ãƒ¼ã‚«ãƒ« ãƒã‚·ãƒ³ä¸Šã«æ–°ã—ã„ SSH éµãƒšã‚¢ã‚’ä½œæˆã—ã¾ã™ã€‚ ã“ã‚Œã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§å®Ÿè¡Œã—ã¾ã™ã€‚ ã‚­ãƒ¼ã‚’ä¿å­˜ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã™ã‚‹ã‚ˆã†ã«æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚ ã“ã‚Œã¯ **ã‚­ãƒ¼å** ã«ãªã‚Šã¾ã™ã€‚

[ED25519 ã¾ãŸã¯ RSA](https://goteleport.com/blog/comparing-ssh-keys/) å…¬é–‹éµã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’é¸æŠã—ã¾ã™ã€‚

{% tabs %}
{% tab title="ED25519" %}
```
ssh-keygen -t ed25519
```
{% endtab %}

{% tab title="RSA" %}
```bash
ssh-keygen -t rsa -b 4096
```
{% endtab %}
{% endtabs %}

å…¬é–‹éµã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã«è»¢é€ã—ã¾ã™ã€‚ **keyname.pub** ã‚’é©åˆ‡ã«æ›´æ–°ã™ã‚‹ã€‚

```bash
ssh-copy-id -i $HOME/.ssh/keyname.pub eterum@server.public.ip.address
```

æ–°ã—ã„ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³

```text
ssh etherum@server.public.ip.address
```

rootãƒ­ã‚°ã‚¤ãƒ³ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚ `/etc/ssh/sshd_config ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™`

```text
sudo nano /etc/ssh/sshd_config
```

**ChallengeResponseAuthentication** ã‚’è¦‹ã¤ã‘ã¦ã€ã„ã„ãˆã«æ›´æ–°ã—ã¾ã™

```text
ChallengeResponseAuthentication no
```

**PasswordAuthentication** ã®æ›´æ–°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„

```text
PasswordAuthentication no
```

**PermitRootLogin** ã‚’è¦‹ã¤ã‘ã¦ã€æ›´æ–°ã—ãªã„

```text
PermitRootLogin no
```

PermitEmptyPasswords **** ã‚’è¦‹ã¤ã‘ã¦ã€æ›´æ–°ã—ãªã„ã‚ˆã†ã«ã—ã¾ã™

```text
PermitEmptyPasswords no
```

**ä»»æ„ã®**: **ãƒãƒ¼ãƒˆ** ã‚’æ¢ã—ã¦ã€ **ãƒ©ãƒ³ãƒ€ãƒ ãª** ãƒãƒ¼ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚

{% hint style="info" %}
1024ã‹ã‚‰49141ã¾ã§ã® **ãƒ©ãƒ³ãƒ€ãƒ ** ãƒãƒ¼ãƒˆ\#ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ [ç«¶åˆã®å¯èƒ½æ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚ ](https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)
{% endhint %}

```bash
ãƒãƒ¼ãƒˆ <port number>
```

æ–°ã—ã„ SSH æ§‹æˆã®æ§‹æ–‡ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

```text
sudo sshd -t
```

æ§‹æ–‡ã®æ¤œè¨¼ã«ã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆã¯ã€SSH ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™

```text
sudo service sshd reload
```

ãƒ­ã‚°ã‚¤ãƒ³ãŒã¾ã å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™

{% tabs %}
{% tab title="Standard SSH Port 22" %}
```text
ssh etherum@server.public.ip.address
```
{% endtab %}

{% tab title="Custom SSH Port" %}
```bash
ssh etherum@server.public.ip.address -p <custom port number>
```
{% endtab %}
{% endtabs %}

{% hint style="info" %}
ã‚ã‚‹ã„ã¯ã€ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ ã‚«ã‚¹ã‚¿ãƒ  SSH ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ `-p <port#>` ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
ssh -i <path to your SSH_key_name.pub> ethereum@server.public.ip.address
```
{% endhint %}

**Optional**: Make logging in easier by updating your local ssh config.

To simplify the ssh command needed to log in to your server, consider updating your local `$HOME/.ssh/config` file:

```bash
Host ethereum-server
  User ethereum
  HostName <server.public.ip.address>
  Port <custom port number>
```

This will allow you to log in with `ssh ethereum-server` rather than needing to pass through all ssh parameters explicitly.

## ğŸ¤– **Update your system**

{% hint style="warning" %}
It's critically important to keep your system up-to-date with the latest patches to prevent intruders from accessing your system.
{% endhint %}

```bash
sudo apt-get update -y && sudo apt-get upgrade -y
sudo apt-get autoremove
sudo apt-get autoclean
```

Enable automatic updates so you don't have to manually install them.

```text
sudo apt-get install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

## ğŸ» Disable root account

System admins should not frequently log in as root in order to maintain server security. Instead, you can use sudo execute that require low-level privileges.

```bash
# To disable the root account, simply use the -l option.
sudo passwd -l root
```

```bash
# If for some valid reason you need to re-enable the account, simply use the -u option.
sudo passwd -u root
```

## ğŸ›  Setup Two Factor Authentication for SSH \[Optional\]

{% hint style="info" %}
SSH, the secure shell, is often used to access remote Linux systems. Because we often use it to connect with computers containing important data, itâ€™s recommended to add another security layer. Here comes the two factor authentication \(_2FA_\).
{% endhint %}

```text
sudo apt install libpam-google-authenticator -y
```

To make SSH use the Google Authenticator PAM module, edit the `/etc/pam.d/sshd` file:

```text
sudo nano /etc/pam.d/sshd
```

Add the following line:

```text
auth required pam_google_authenticator.so
```

Now you need to restart the `sshd` daemon using:

```text
sudo systemctl restart sshd.service
```

Modify `/etc/ssh/sshd_config`

```text
sudo nano /etc/ssh/sshd_config
```

Locate **ChallengeResponseAuthentication** and update to yes

```text
ChallengeResponseAuthentication yes
```

Locate **UsePAM** and update to yes

```text
UsePAM yes
```

Save the file and exit.

Run the **google-authenticator** command.

```text
google-authenticator
```

It will ask you a series of questions, here is a recommended configuration:

* ãƒˆãƒ¼ã‚¯ãƒ³ã€Œã‚¿ã‚¤ãƒ ãƒ™ãƒ¼ã‚¹ã€ã‚’ä½œæˆã—ã¾ã™ï¼šã¯ã„
* `.google_authenticator` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã™ã‚‹: yes
* è¤‡æ•°ã®ä½¿ç”¨ã‚’è¨±å¯ã—ãªã„: ã¯ã„
* å…ƒã®ç”Ÿæˆæ™‚é–“åˆ¶é™ã‚’å¢—ã‚„ã—ã¾ã™: ã„ã„ãˆ
* ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’æœ‰åŠ¹ã«ã™ã‚‹: ã¯ã„

You may have noticed the giant QR code that appeared during the process, underneath are your emergency scratch codes to be used if you donâ€™t have access to your phone: write them down on paper and keep them in a safe place.

Now, open Google Authenticator on your phone and add your secret key to make two factor authentication work.

{% hint style="danger" %}
**Note**: If you are enabling 2FA on a remote machine that you access over SSH you need to follow **steps 2 and 3** of [this tutorial](https://www.digitalocean.com/community/tutorials/how-to-set-up-multi-factor-authentication-for-ssh-on-ubuntu-18-04) to make 2FA work.
{% endhint %}

## ğŸ§© Secure Shared Memory

{% hint style="info" %}
One of the first things you should do is secure the shared [memory](https://www.lifewire.com/what-is-random-access-memory-ram-2618159) used on the system. If you're unaware, shared memory can be used in an attack against a running service. Because of this, secure that portion of system memory.

To learn more about secure shared memory, read this [techrepublic.com article](https://www.techrepublic.com/article/how-to-enable-secure-shared-memory-on-ubuntu-server/).
{% endhint %}

{% hint style="warning" %}
### 1ã¤ã®ä¾‹å¤–çš„ãªã‚±ãƒ¼ã‚¹

There may be a reason for you needing to have that memory space mounted in read/write mode \(such as a specific server application like **DappNode** that requires such access to the shared memory or standard applications like Google Chrome\). In this case, use the following line for the fstab file with instructions below.

```text
none /run/shm tmpfs rw,noexec,nosuid,nodev 0 0
```

The above line will mount the shared memory with read/write access but without permission to execute programs, change the UID of running programs, or to create block or character devices in the namespace. This a net security improvement over default settings.

### æ³¨æ„ã—ã¦ä½¿ç”¨ã™ã‚‹

With some trial and error, you may discover some applications\(**like DappNode**\) do not work with shared memory in read-only mode. For the highest security and if compatible with your applications, it is a worthwhile endeavor to implement this secure shared memory setting.

Source: [techrepublic.com](https://www.techrepublic.com/article/how-to-enable-secure-shared-memory-on-ubuntu-server/)
{% endhint %}

Edit `/etc/fstab`

```text
sudo nano /etc/fstab
```

Insert the following line to the bottom of the file and save/close. This sets shared memory into read-only mode.

```text
tmpfs    /run/shm    tmpfs    ro,noexec,nosuid    0 0
```

Reboot the node in order for changes to take effect.

```text
sudo reboot
```

## â›“**Install Fail2ban**

{% hint style="info" %}
Fail2ban is an intrusion-prevention system that monitors log files and searches for particular patterns that correspond to a failed login attempt. If a certain number of failed logins are detected from a specific IP address \(within a specified amount of time\), fail2ban blocks access from that IP address.
{% endhint %}

```text
sudo apt-get install fail2ban -y
```

Edit a config file that monitors SSH logins.

```text
sudo nano /etc/fail2ban/jail.local
```

Add the following lines to the bottom of the file.

{% hint style="info" %}
ğŸ”¥ **Whitelisting IP address tip**: The `ignoreip` parameter accepts IP addresses, IP ranges or DNS hosts that you can specify to be allowed to connect. This is where you want to specify your local machine, local IP range or local domain, separated by spaces.

```bash
# Example
ignoreip = 192.168.1.0/24 127.0.0.1/8 
```
{% endhint %}

```bash
[sshd]
enabled = true
port = <22 or your random port number>
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
# whitelisted IP addresses
ignoreip = <list of whitelisted IP address, your local daily laptop/pc>
```

Save/close file.

Restart fail2ban for settings to take effect.

```text
sudo systemctl restart fail2ban
```

## ğŸ§±**Configure your Firewall**

The standard UFW firewall can be used to control network access to your node.

With any new installation, ufw is disabled by default. Enable it with the following settings.

* ãƒãƒ¼ãƒˆ 22 \(ã¾ãŸã¯ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒ¼ãƒˆ \#\) SSH æ¥ç¶šã®ãŸã‚ã® TCP
* p2p ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ãƒãƒ¼ãƒˆ
  * ç¯å°ã¯ãƒãƒ¼ãƒˆ9000tcp/udpã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
  * Tekuã¯ãƒãƒ¼ãƒˆ 9000 tcp/udp ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
  * Prysmã¯ãƒãƒ¼ãƒˆ 13000 tcpã¨ãƒãƒ¼ãƒˆ 12000 udpã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
  * Nimbus ã¯ãƒãƒ¼ãƒˆ 9000 tcp/udp ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
  * ãƒ­ãƒ‡ã‚¹ã‚¿ãƒ«ã¯ãƒãƒ¼ãƒˆ30607 tcpã¨ãƒãƒ¼ãƒˆ9000udpã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
* ãƒãƒ¼ãƒˆ 30303 tcp/udp eth1 ãƒãƒ¼ãƒ‰

{% tabs %}
{% tab title="Lighthouse" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status number@@7
```
{% endtab %}

{% tab title="Prysm" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 13000/tcp
sudo ufw allow 12000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}

{% tab title="Teku" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status number@@7
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status number@@7
```
{% endtab %}

{% tab title="Lodestar" %}
```bash
sudo ufw allow <22 or your random port number>/tcp
sudo ufw allow 30607/tcp
sudo ufw allow 9000/udp
sudo ufw allow 30303/tcp
sudo ufw allow 30303/udp
sudo ufw enable
sudo ufw status numbered
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Do not expose Grafana \(port 3000\) and Prometheus endpoint \(port 9090\) to the public internet as this invites a new attack surface! A secure solution would be to access Grafana through a ssh tunnel with Wireguard.
{% endhint %}

Only open the following ports on local home staking setups behind a home router firewall or other network firewall.

\*\*\*\*ğŸ”¥ **It is dangerous to open these ports on a VPS/cloud node.**

```bash
sudo ufw allow 3000/tcp
sudo ufw allow 9090/tcp
```

Confirm the settings are in effect.
> ```csharp
     To                         Action      From
     --                         ------      ----
[ 1] 22/tcp                     ALLOW IN    Anywhere
# SSH
[ 2] 3000/tcp                   ALLOW IN    Anywhere
# Grafana
[ 3] 9000/tcp                   ALLOW IN    Anywhere
# eth2 p2p traffic
[ 4] 9090/tcp                   ALLOW IN    Anywhere
# Prometheus
[ 5] 30303/tcp                  ALLOW IN    Anywhere
# eth1 node
[ 6] 22/tcp (v6)                ALLOW IN    Anywhere (v6)
# SSH
[ 7] 3000/tcp (v6)              ALLOW IN    Anywhere (v6)
# Grafana
[ 8] 9000/tcp (v6)              ALLOW IN    Anywhere (v6)
# eth2 p2p traffic
[ 9] 9090/tcp (v6)              ALLOW IN    Anywhere (v6)
# Prometheus
[10] 30303/tcp (v6)             ALLOW IN    Anywhere (v6)
# eth1 node
```

**\[ Optional but recommended \]** Whitelisting \(or permitting connections from a specific IP\) can be setup via the following command.

```bash
sudo ufw allow from <your local daily laptop/pc>
# Example
# sudo ufw allow from 192.168.50.22
```

{% hint style="info" %}
 ğŸŠ **Port Forwarding Tip:** You'll need to forward and open ports to your validator. [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) ã¾ãŸã¯ [https://canyouseeme.org/](https://canyouseeme.org/) ã§å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
{% endhint %}

## ğŸ“ Verify Listening Ports

If you want to maintain a secure server, you should validate the listening network ports every once in a while. This will provide you essential information about your network.

```bash
sudo ss -tulpn
# Example output. ãƒãƒ¼ãƒˆç•ªå·ãŒæ­£ã—ãè¦‹ãˆã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
# Netid  State    Recv-Q  Send-Q    Local Address:Port   Peer Address:Port   Process
# tcp    LISTEN   0       128       127.0.0.1:5052       0.0.0.0:*           users:(("lighthouse",pid=12160,fd=22))
# tcp    LISTEN   0       128       127.0.0.1:5054       0.0.0.0:*           users:(("lighthouse",pid=12160,fd=23))
# tcp    LISTEN   0       1024      0.0.0.0:9000         0.0.0.0:*           users:(("lighthouse",pid=12160,fd=21))
# udp    UNCONN   0       0         *:30303              *:*                 users:(("geth",pid=22117,fd=158))
# tcp    LISTEN   0       4096      *:30303              *:*                 users:(("geth",pid=22117,fd=156))
```

Alternatively you can use `netstat`

```bash
sudo netstat -tulpn
# Example output. ãƒãƒ¼ãƒˆç•ªå·ãŒæ­£ã—ãè¦‹ãˆã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
# Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
# tcp        0      0 127.0.0.1:5052          0.0.0.0:*               LISTEN      12160/lighthouse
# tcp        0      0 127.0.0.1:5054          0.0.0.0:*               LISTEN      12160/lighthouse
# tcp        0      0 0.0.0.0:9000            0.0.0.0:*               LISTEN      12160/lighthouse
# tcp6       0      0 :::30303                :::*                    LISTEN      22117/geth
# udp6       0      0 :::30303                :::*                    LISTEN      22117/geth
```

## ğŸ‘©ğŸš€ **Use** system user accounts - Principle of Least Privilege \[Advanced Users / Optional\]

{% hint style="info" %}
**Recommended for Advanced Users Only**

**Principle of Least Privilege**: Each eth2 process is assigned a _system user account_ and runs under the least amount of privileges required in order to function. This best practice protects against a scenario where a vulnerability or exploit discovered in a specific process might enable access other system processes.
{% endhint %}

```bash
# creates system user account for eth1 service
sudo adduser --system --no-create-home eth1

# creates system user account for validator service
sudo adduser --system --no-create-home validator

# creates system user account for beacon-chain service
sudo adduser --system --no-create-home beacon-chain

# creates system user account for slasher
sudo adduser --system --no-create-home slasher
```

{% hint style="danger" %}
\*\*\*\*ğŸ”¥ **Caveats For Advanced Users**

If you decide to use **system user accounts**, remember to replace the **systemd unit files** with the corresponding users.

```bash
# Example of beacon-chain.service unit file
User            = beacon-chain
```

Furthermore, ensure the correct **file ownership** is assigned to your **system user account** where applicable.

```bash
# Example of prysm validator's password file
sudo chown validator:validator -R $HOME/.eth2validators/validators-password.txt
```
{% endhint %}

## âœ¨ Additional validator node best practices

<table>
  <thead>
    <tr>
      <th style="text-align:left"></th>
      <th style="text-align:left"></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</td>
      <td style="text-align:left">
        <p></p>
        <p>é™çš„å†…éƒ¨IPã‚’ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒ‰ã¨ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ¼ãƒˆãƒ‘ã‚½ã‚³ãƒ³ã®ä¸¡æ–¹ã«å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
          ã“ã‚Œã¯ã€ufw ãŠã‚ˆã³ Fail2ban&apos;ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ
          æ©Ÿèƒ½ã¨çµ„ã¿åˆã‚ã›ã¦ä¾¿åˆ©ã§ã™ã€‚ é€šå¸¸ã€ã“ã‚Œã¯ãƒ«ãƒ¼ã‚¿ãƒ¼&apos;ã®è¨­å®šã§è¨­å®šã§ãã¾ã™ã€‚
          æ‰‹é †ã«ã¤ã„ã¦ã¯ã€ãƒ«ãƒ¼ã‚¿ãƒ¼&apos;ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">åœé›»çŠ¶æ…‹</td>
      <td style="text-align:left">åœé›»ã®å ´åˆã¯ã€é›»æºãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã‚‰ã™ãã«
        ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒã‚·ãƒ³ã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ BIOS è¨­å®šã§ã€ <b>Restore on AC / Power Loss</b> ã¾ãŸã¯ <b>After Power Loss</b> è¨­å®š
        ã‚’å¸¸ã«ã‚ªãƒ³ã«å¤‰æ›´ã—ã¾ã™ã€‚ ã‚‚ã£ã¨è‰¯ã„ã“ã¨ã«ã€ç„¡åœé›»é›»æºè£…ç½®(UPS)ã‚’è¨­ç½®ã—ã¦ãã ã•ã„ã€‚</td>
    </tr>
    <tr>
      <td style="text-align:left">Bash å±¥æ­´ã‚’æ¶ˆå»</td>
      <td style="text-align:left">
        <p>ä¸ŠçŸ¢å°ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã€
          ã®æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ã‚³ãƒãƒ³ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ ã“ã‚Œã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
        <p><code>shred -u ~/.bash_history &amp;&amp; touch ~/.bash_history</code>
        </p>
      </td>
    </tr>
  </tbody>
</table>

{% hint style="info" %}
å¿…ãš [ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ\| å¥å…¨ãªæ©Ÿèƒ½ETH2ãƒãƒªãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚](guide-or-how-to-setup-a-validator-on-eth2-mainnet/checklist-or-how-to-confirm-a-healthy-functional-eth2-validator.md)
{% endhint %}

## ğŸ¤– Start staking by building a validator

### ç§ãŸã¡ã® [ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã‚¬ã‚¤ãƒ‰](guide-or-how-to-setup-a-validator-on-eth2-mainnet/) ã€ [ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã‚¬ã‚¤ãƒ‰](guide-or-how-to-setup-a-validator-on-eth2-testnet.md)ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ã€‚

{% hint style="success" %}
ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚ã‚¬ã‚¤ãƒ‰ãŒå®Œæˆã—ã¾ã—ãŸã€‚ âœ¨

ç§ãŸã¡ã®ã‚¬ã‚¤ãƒ‰ãŒå½¹ã«ç«‹ã¡ã¾ã—ãŸã‹ï¼Ÿ ãƒ’ãƒ³ãƒˆä»˜ãã®ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ç¶šã‘ã¾ã™ã€‚

æœ€é«˜ã®æš—å·ã‚¬ã‚¤ãƒ‰ã‚’ä½œæˆã—ç¶šã‘ã‚‹ã“ã¨ã¯ã€æœ¬å½“ã«ç§ãŸã¡ã«åŠ›ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚

[coint.eeã‚’ä½¿ç”¨ã—ã¦ã€å¯„ä»˜ ](https://cointr.ee/coincashew)ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ ğŸ™

ã©ã‚“ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ã™ã¹ã¦ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯éå¸¸ã«é«˜ãè©•ä¾¡ã•ã‚Œã¾ã™ã€‚ ğŸŒ›

Discordã§ä»²é–“ã®ã‚¹ãƒ†ãƒ¼ã‚«ãƒ¼ã¨ãƒãƒ£ãƒƒãƒˆã—ã¾ã—ã‚‡ã† @

[https://discord.gg/w8Bx8W2HPW](https://discord.gg/w8Bx8W2HPW)ğŸ˜ƒ
{% endhint %}

ğŸŠ **2020-12 Update**: Thanks to all [Gitcoin](https://gitcoin.co/grants/1653/eth2-staking-guides-by-coincashew) contributors, where you can contribute via [quadratic funding](https://vitalik.ca/general/2019/12/07/quadratic.html) and make a big impact. è³‡é‡‘èª¿é”å®Œäº†ï¼ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™!ğŸ™

{% embed url="https://gitcoin.co/grants/1653/eth2-staking-guides-by-constashew" %}

## ğŸš€ References

{% embed url="https://medium.com/@BaneBiddix/how-to-harden-your-ubuntu-18-04-server-ffc4b6658fe7" caption="" %}

{% embed url="https://linux-audit.com/ubuntu-server-hardening-guide-quick-and-secure/" caption="" %}

{% embed url="https://www.digitalocean.com/community/tutorials/how-to-harden-openssh-on-ubuntu-18-04" caption="" %}

{% embed url="https://ubuntu.com/tutorials/configure-ssh-2fa\#1-overview" caption="" %}

{% embed url="https://linuxize.com/post/install-configure-fail2ban-on-ubuntu-20-04/" %}

[https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3\#file-ubuntu-hardening-md](https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3#file-ubuntu-hardening-md)

{% embed url="https://www.lifewire.com/harden-ubuntu-server-security-4178243" caption="" %}

{% embed url="https://www.ubuntupit.com/best-linux-hardening-security-tips-a-comprehensive-checklist/" caption="" %}

